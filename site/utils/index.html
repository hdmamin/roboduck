
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../magic/">
      
      
        <link rel="next" href="../shell/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>Utils - RoboDuck</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ded33207.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lib.roboduck.utils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RoboDuck" class="md-header__button md-logo" aria-label="RoboDuck" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RoboDuck
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Utils
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RoboDuck" class="md-nav__button md-logo" aria-label="RoboDuck" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RoboDuck
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to MkDocs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Debug
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../magic/" class="md-nav__link">
        Magic
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Utils
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils" class="md-nav__link">
    lib.roboduck.utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_docstring" class="md-nav__link">
    add_docstring()
  </a>
  
    <nav class="md-nav" aria-label="add_docstring()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_docstring--examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_kwargs" class="md-nav__link">
    add_kwargs()
  </a>
  
    <nav class="md-nav" aria-label="add_kwargs()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_kwargs--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_kwargs--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.available_models" class="md-nav__link">
    available_models()
  </a>
  
    <nav class="md-nav" aria-label="available_models()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.available_models--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colordiff_new_str" class="md-nav__link">
    colordiff_new_str()
  </a>
  
    <nav class="md-nav" aria-label="colordiff_new_str()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colordiff_new_str--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colordiff_new_str--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colored" class="md-nav__link">
    colored()
  </a>
  
    <nav class="md-nav" aria-label="colored()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colored--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colored--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code" class="md-nav__link">
    extract_code()
  </a>
  
    <nav class="md-nav" aria-label="extract_code()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--corrected-code-snippet" class="md-nav__link">
    Corrected code snippet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--corrected-code-snippet_1" class="md-nav__link">
    Corrected code snippet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.is_ipy_name" class="md-nav__link">
    is_ipy_name()
  </a>
  
    <nav class="md-nav" aria-label="is_ipy_name()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.is_ipy_name--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.is_ipy_name--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_current_ipython_session" class="md-nav__link">
    load_current_ipython_session()
  </a>
  
    <nav class="md-nav" aria-label="load_current_ipython_session()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_current_ipython_session--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_current_ipython_session--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_ipynb" class="md-nav__link">
    load_ipynb()
  </a>
  
    <nav class="md-nav" aria-label="load_ipynb()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_ipynb--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_ipynb--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_yaml" class="md-nav__link">
    load_yaml()
  </a>
  
    <nav class="md-nav" aria-label="load_yaml()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_yaml--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_yaml--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.parse_completion" class="md-nav__link">
    parse_completion()
  </a>
  
    <nav class="md-nav" aria-label="parse_completion()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.parse_completion--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.parse_completion--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.save_notebook" class="md-nav__link">
    save_notebook()
  </a>
  
    <nav class="md-nav" aria-label="save_notebook()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.save_notebook--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.store_class_defaults" class="md-nav__link">
    store_class_defaults()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.truncated_repr" class="md-nav__link">
    truncated_repr()
  </a>
  
    <nav class="md-nav" aria-label="truncated_repr()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.truncated_repr--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.truncated_repr--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.type_annotated_dict_str" class="md-nav__link">
    type_annotated_dict_str()
  </a>
  
    <nav class="md-nav" aria-label="type_annotated_dict_str()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.type_annotated_dict_str--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.type_annotated_dict_str--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.typecheck" class="md-nav__link">
    typecheck()
  </a>
  
    <nav class="md-nav" aria-label="typecheck()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.typecheck--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.typecheck--examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        Shell
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/cli/" class="md-nav__link">
        TODO: not working. Also tried leading ".." but that throws empty import error.
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils" class="md-nav__link">
    lib.roboduck.utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_docstring" class="md-nav__link">
    add_docstring()
  </a>
  
    <nav class="md-nav" aria-label="add_docstring()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_docstring--examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_kwargs" class="md-nav__link">
    add_kwargs()
  </a>
  
    <nav class="md-nav" aria-label="add_kwargs()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_kwargs--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.add_kwargs--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.available_models" class="md-nav__link">
    available_models()
  </a>
  
    <nav class="md-nav" aria-label="available_models()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.available_models--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colordiff_new_str" class="md-nav__link">
    colordiff_new_str()
  </a>
  
    <nav class="md-nav" aria-label="colordiff_new_str()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colordiff_new_str--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colordiff_new_str--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colored" class="md-nav__link">
    colored()
  </a>
  
    <nav class="md-nav" aria-label="colored()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colored--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.colored--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code" class="md-nav__link">
    extract_code()
  </a>
  
    <nav class="md-nav" aria-label="extract_code()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--corrected-code-snippet" class="md-nav__link">
    Corrected code snippet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.extract_code--corrected-code-snippet_1" class="md-nav__link">
    Corrected code snippet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.is_ipy_name" class="md-nav__link">
    is_ipy_name()
  </a>
  
    <nav class="md-nav" aria-label="is_ipy_name()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.is_ipy_name--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.is_ipy_name--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_current_ipython_session" class="md-nav__link">
    load_current_ipython_session()
  </a>
  
    <nav class="md-nav" aria-label="load_current_ipython_session()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_current_ipython_session--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_current_ipython_session--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_ipynb" class="md-nav__link">
    load_ipynb()
  </a>
  
    <nav class="md-nav" aria-label="load_ipynb()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_ipynb--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_ipynb--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_yaml" class="md-nav__link">
    load_yaml()
  </a>
  
    <nav class="md-nav" aria-label="load_yaml()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_yaml--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.load_yaml--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.parse_completion" class="md-nav__link">
    parse_completion()
  </a>
  
    <nav class="md-nav" aria-label="parse_completion()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.parse_completion--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.parse_completion--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.save_notebook" class="md-nav__link">
    save_notebook()
  </a>
  
    <nav class="md-nav" aria-label="save_notebook()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.save_notebook--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.store_class_defaults" class="md-nav__link">
    store_class_defaults()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.truncated_repr" class="md-nav__link">
    truncated_repr()
  </a>
  
    <nav class="md-nav" aria-label="truncated_repr()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.truncated_repr--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.truncated_repr--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.type_annotated_dict_str" class="md-nav__link">
    type_annotated_dict_str()
  </a>
  
    <nav class="md-nav" aria-label="type_annotated_dict_str()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.type_annotated_dict_str--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.type_annotated_dict_str--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.utils.typecheck" class="md-nav__link">
    typecheck()
  </a>
  
    <nav class="md-nav" aria-label="typecheck()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.typecheck--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.utils.typecheck--examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Utils</h1>

<div class="doc doc-object doc-module">


<a id="lib.roboduck.utils"></a>
  <div class="doc doc-contents first">
  
      <p>Utility functions used by other roboduck modules.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.add_docstring" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_docstring</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add the docstring from another function/class to the decorated
function/class.</p>
<p>Ported from htools to avoid extra dependency.</p>
<h4 id="lib.roboduck.utils.add_docstring--examples">Examples</h4>
<div class="highlight"><pre><span></span><code>@add_docstring(nn.Conv2d)
class ReflectionPaddedConv2d(nn.Module):
    # ...
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_docstring</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add the docstring from another function/class to the decorated</span>
<span class="sd">    function/class.</span>

<span class="sd">    Ported from htools to avoid extra dependency.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```</span>
<span class="sd">    @add_docstring(nn.Conv2d)</span>
<span class="sd">    class ReflectionPaddedConv2d(nn.Module):</span>
<span class="sd">        # ...</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">new_func</span><span class="p">):</span>
        <span class="n">new_func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">new_func</span><span class="o">.</span><span class="vm">__doc__</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">new_func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">new_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.add_kwargs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">hide_fields</span><span class="o">=</span><span class="p">(),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Decorator that adds parameters into the signature and docstring of a
function that accepts **kwargs.</p>
<h4 id="lib.roboduck.utils.add_kwargs--parameters">Parameters</h4>

<details class="func">
  <summary>function</summary>
  <p>Function to decorate.</p>
</details>
<details class="fields">
  <summary>list[str]</summary>
  <p>Names of params to insert into signature + docstring.</p>
</details>
<details class="hide_fields">
  <summary>list[str]</summary>
  <p>Names of params that are <em>already</em> in the function's signature that
we want to hide. To use a non-empty value here, we must set strict=True
and the param must have a default value, as this is what will be used
in all subsequent calls.</p>
</details>
<details class="strict">
  <summary>bool</summary>
  <p>If true, we do two things:
1. On decorated function call, check that the user provided all
expected arguments.
2. Enable the use of the <code>hide_fields</code> param.</p>
</details>      <h4 id="lib.roboduck.utils.add_kwargs--returns">Returns</h4>
<p>function</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">hide_fields</span><span class="o">=</span><span class="p">(),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator that adds parameters into the signature and docstring of a</span>
<span class="sd">    function that accepts **kwargs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func: function</span>
<span class="sd">        Function to decorate.</span>
<span class="sd">    fields: list[str]</span>
<span class="sd">        Names of params to insert into signature + docstring.</span>
<span class="sd">    hide_fields: list[str]</span>
<span class="sd">        Names of params that are *already* in the function&#39;s signature that</span>
<span class="sd">        we want to hide. To use a non-empty value here, we must set strict=True</span>
<span class="sd">        and the param must have a default value, as this is what will be used</span>
<span class="sd">        in all subsequent calls.</span>
<span class="sd">    strict: bool</span>
<span class="sd">        If true, we do two things:</span>
<span class="sd">        1. On decorated function call, check that the user provided all</span>
<span class="sd">        expected arguments.</span>
<span class="sd">        2. Enable the use of the `hide_fields` param.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Hide_fields must have default values in existing function. They will not</span>
    <span class="c1"># show up in the new docstring and the user will not be able to pass in a</span>
    <span class="c1"># value when calling the new function - it will always use the default.</span>
    <span class="c1"># To set different defaults, you can pass in a partial rather than a</span>
    <span class="c1"># function as the first arg here.</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hide_fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;You must set strict=True when providing one or more &#39;</span>
            <span class="s1">&#39;hide_fields. Otherwise the user can still pass in those args.&#39;</span>
        <span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
    <span class="n">params_</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Remove any fields we want to hide.</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">hide_fields</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params_</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No need to hide field </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1"> because it</span><span class="se">\&#39;</span><span class="s1">s not &#39;</span>
                          <span class="s1">&#39;in the existing function signature.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">params_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Field &quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">&quot; is not a valid hide_field because it has &#39;</span>
                <span class="s1">&#39;no default value in the original function.&#39;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">params_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s1">&#39;kind&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Function </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s1"> must accept **kwargs.&#39;</span><span class="p">)</span>
    <span class="n">new_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span>
    <span class="p">}</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_params</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">params_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">overlap</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Some of the kwargs you tried to inject into </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s1"> already &#39;</span>
            <span class="s1">&#39;exist in its signature. This is not allowed because it</span><span class="se">\&#39;</span><span class="s1">s &#39;</span>
            <span class="s1">&#39;unclear how to resolve default values and parameter type.&#39;</span>
        <span class="p">)</span>

    <span class="n">params_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_params</span><span class="p">)</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">params_</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
        <span class="c1"># In practice langchain checks for this anyway if we ask for a</span>
        <span class="c1"># completion, but outside of that context we need typecheck</span>
        <span class="c1"># because otherwise we could provide no kwargs and _func wouldn&#39;t</span>
        <span class="c1"># complain. Just use generic type because we only care that a value is</span>
        <span class="c1"># provided.</span>
        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">typecheck</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="nb">object</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.available_models" class="doc doc-heading">
<code class="highlight language-python"><span class="n">available_models</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Show user available values for model_name parameter in debug.DuckDB
class/ debug.duck function/errors.enable function etc.</p>
<h4 id="lib.roboduck.utils.available_models--returns">Returns</h4>
<p>dict[str, list[str]]: Maps provider name (e.g. 'openai') to list of valid
model_name values. Provider name should correspond to a langchain or
roboduck class named like ChatOpenai (i.e. Chat{provider.title()}).</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">available_models</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show user available values for model_name parameter in debug.DuckDB</span>
<span class="sd">    class/ debug.duck function/errors.enable function etc.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict[str, list[str]]: Maps provider name (e.g. &#39;openai&#39;) to list of valid</span>
<span class="sd">    model_name values. Provider name should correspond to a langchain or</span>
<span class="sd">    roboduck class named like ChatOpenai (i.e. Chat{provider.title()}).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># This logic may not always hold but as of April 2023, this returns</span>
    <span class="c1"># openai&#39;s available chat models.</span>
    <span class="n">openai_res</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;openai&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">openai_res</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                     <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gpt&#39;</span><span class="p">)]</span>

    <span class="c1"># TODO: add anthropic/cohere/other?</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.colordiff_new_str" class="doc doc-heading">
<code class="highlight language-python"><span class="n">colordiff_new_str</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given two strings, return the new one with new parts in green. Note that
deletions are ignored because we want to retain only characters in the new
string. Remember colors are only displayed correctly when printing the
resulting string - otherwise it just looks like we added extra junk
characters.</p>
<p>Idea is that when displaying a revised code snippet from gpt, we want to
draw attention to the new bits.</p>
<p>Adapted from this gist + variations in comments:
https://gist.github.com/ines/04b47597eb9d011ade5e77a068389521</p>
<h4 id="lib.roboduck.utils.colordiff_new_str--parameters">Parameters</h4>

<details class="old">
  <summary>str</summary>
  <p>This is what <code>new</code> is compared to when identifying differences.</p>
</details>
<details class="new">
  <summary>str</summary>
  <p>Determines content of output str.</p>
</details>
<details class="color">
  <summary>str</summary>
  <p>Text color for new characters.</p>
</details>      <h4 id="lib.roboduck.utils.colordiff_new_str--returns">Returns</h4>
<p>str: Same content as <code>new</code> but color new parts in a different color.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">colordiff_new_str</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given two strings, return the new one with new parts in green. Note that</span>
<span class="sd">    deletions are ignored because we want to retain only characters in the new</span>
<span class="sd">    string. Remember colors are only displayed correctly when printing the</span>
<span class="sd">    resulting string - otherwise it just looks like we added extra junk</span>
<span class="sd">    characters.</span>

<span class="sd">    Idea is that when displaying a revised code snippet from gpt, we want to</span>
<span class="sd">    draw attention to the new bits.</span>

<span class="sd">    Adapted from this gist + variations in comments:</span>
<span class="sd">    https://gist.github.com/ines/04b47597eb9d011ade5e77a068389521</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    old: str</span>
<span class="sd">        This is what `new` is compared to when identifying differences.</span>
<span class="sd">    new: str</span>
<span class="sd">        Determines content of output str.</span>
<span class="sd">    color: str</span>
<span class="sd">        Text color for new characters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str: Same content as `new` but color new parts in a different color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matcher</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">matcher</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="n">s2</span><span class="p">:</span><span class="n">e2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">):</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.colored" class="doc doc-heading">
<code class="highlight language-python"><span class="n">colored</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add tags to color text and then reset color afterwards. Note that this
does NOT actually print anything.</p>
<h4 id="lib.roboduck.utils.colored--parameters">Parameters</h4>

<details class="text">
  <summary>str</summary>
  <p>Text that should be colored.</p>
</details>
<details class="color">
  <summary>color</summary>
  <p>Color name, e.g. "red". Must be available in the colorama lib. If None
or empty str, just return the text unchanged.</p>
</details>      <h4 id="lib.roboduck.utils.colored--returns">Returns</h4>
<p>str</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">colored</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add tags to color text and then reset color afterwards. Note that this</span>
<span class="sd">    does NOT actually print anything.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text: str</span>
<span class="sd">        Text that should be colored.</span>
<span class="sd">    color:</span>
<span class="sd">        Color name, e.g. &quot;red&quot;. Must be available in the colorama lib. If None</span>
<span class="sd">        or empty str, just return the text unchanged.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="n">color</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Fore</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">text</span><span class="si">}{</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s1">&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.extract_code" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_code</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">join_multi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi_prefix_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"># </span><span class="si">{i}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Extract code snippet from a GPT response (e.g. from our <code>debug</code> chat
prompt. See <code>Examples</code> for expected format.</p>
<h4 id="lib.roboduck.utils.extract_code--parameters">Parameters</h4>
<p>text: str</p>

<details class="join_multi">
  <summary>bool</summary>
  <p>If multiple code snippets are found, we can either choose to join them
into one string or return a list of strings. If the former, we prefix
each snippet with <code>multi_prefix_template</code> to make it clearer where
each new snippet starts.</p>
</details>
<details class="multi_prefix_template">
  <summary>str</summary>
  <p>If join_multi=True and multiple code snippets are found, we prepend
this to each code snippet before joining into a single string. It
should accept a single parameter {i} which numbers each code snippet
in the order they were found in <code>text</code> (1-indexed).</p>
</details>      <h4 id="lib.roboduck.utils.extract_code--returns">Returns</h4>
<p>str or list: code snippet from <code>text</code>. If we find multiple snippets, we
either join them into one big string (if join_multi is True) or return a
list of strings otherwise.</p>
<h4 id="lib.roboduck.utils.extract_code--examples">Examples</h4>
<p>text = '''Appending to a tuple is not allowed because tuples are immutable.
However, in this code snippet, the tuple b contains two lists, and lists
are mutable. Therefore, appending to b[1] (which is a list) does not raise
an error. To fix this, you can either change b[1] to a tuple or create a
new tuple that contains the original elements of b and the new list.</p>
<p>```</p>
<h3 id="lib.roboduck.utils.extract_code--corrected-code-snippet">Corrected code snippet</h3>
<p>a = 3
b = ([0, 1], [2, 3])
b = (b[0], b[1] + [a])
```'''
print(extract_code(text))</p>
<h3 id="lib.roboduck.utils.extract_code--corrected-code-snippet_1">Corrected code snippet</h3>
<p>a = 3
b = ([0, 1], [2, 3])
b = (b[0], b[1] + [a])</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_code</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">join_multi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi_prefix_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"># </span><span class="si">{i}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract code snippet from a GPT response (e.g. from our `debug` chat</span>
<span class="sd">    prompt. See `Examples` for expected format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text: str</span>
<span class="sd">    join_multi: bool</span>
<span class="sd">        If multiple code snippets are found, we can either choose to join them</span>
<span class="sd">        into one string or return a list of strings. If the former, we prefix</span>
<span class="sd">        each snippet with `multi_prefix_template` to make it clearer where</span>
<span class="sd">        each new snippet starts.</span>
<span class="sd">    multi_prefix_template: str</span>
<span class="sd">        If join_multi=True and multiple code snippets are found, we prepend</span>
<span class="sd">        this to each code snippet before joining into a single string. It</span>
<span class="sd">        should accept a single parameter {i} which numbers each code snippet</span>
<span class="sd">        in the order they were found in `text` (1-indexed).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str or list: code snippet from `text`. If we find multiple snippets, we</span>
<span class="sd">    either join them into one big string (if join_multi is True) or return a</span>
<span class="sd">    list of strings otherwise.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    text = &#39;&#39;&#39;Appending to a tuple is not allowed because tuples are immutable.</span>
<span class="sd">    However, in this code snippet, the tuple b contains two lists, and lists</span>
<span class="sd">    are mutable. Therefore, appending to b[1] (which is a list) does not raise</span>
<span class="sd">    an error. To fix this, you can either change b[1] to a tuple or create a</span>
<span class="sd">    new tuple that contains the original elements of b and the new list.</span>

<span class="sd">    ```</span>
<span class="sd">    # Corrected code snippet</span>
<span class="sd">    a = 3</span>
<span class="sd">    b = ([0, 1], [2, 3])</span>
<span class="sd">    b = (b[0], b[1] + [a])</span>
<span class="sd">    ```&#39;&#39;&#39;</span>
<span class="sd">    print(extract_code(text))</span>

<span class="sd">    # Corrected code snippet</span>
<span class="sd">    a = 3</span>
<span class="sd">    b = ([0, 1], [2, 3])</span>
<span class="sd">    b = (b[0], b[1] + [a])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;(?s)```(?:python)?</span><span class="se">\n</span><span class="s2">(.*?)</span><span class="se">\n</span><span class="s2">```&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">join_multi</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">chunks</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">multi_prefix_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">chunk</span>
                  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.is_ipy_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_ipy_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">count_as_true</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">,</span> <span class="s1">&#39;_dh&#39;</span><span class="p">,</span> <span class="s1">&#39;_ih&#39;</span><span class="p">,</span> <span class="s1">&#39;_ii&#39;</span><span class="p">,</span> <span class="s1">&#39;_iii&#39;</span><span class="p">,</span> <span class="s1">&#39;_oh&#39;</span><span class="p">))</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if a variable name looks like an ipython output cell, e.g.
"<em>49", "</em>", or "__".</p>
<p>Ported from htools to avoid extra dependency.</p>
<p>More examples:
Returns True for names like (technically not sure if something like "<strong>i3"
is actually used in ipython, but it looks like something we probably want
to remove in these contexts anyway /shrug):
['_', '</strong>', '_i3', '__i3', '_4', '_9913', '__7', '__23874']</p>
<p>Returns False for names like
['_a', 'i22', '__0i', '_03z', '__99t']
and most "normal" variable names.</p>
<h4 id="lib.roboduck.utils.is_ipy_name--parameters">Parameters</h4>
<p>name: str</p>

<details class="count_as_true">
  <summary>Iterable[str]</summary>
  <p>Additional variable names that don't necessarily fit the standard
pattern but should nonetheless return True if we encounter them.</p>
</details>      <h4 id="lib.roboduck.utils.is_ipy_name--returns">Returns</h4>
<p>bool: True if it looks like an ipython output cell name, False otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_ipy_name</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">count_as_true</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">,</span> <span class="s1">&#39;_dh&#39;</span><span class="p">,</span> <span class="s1">&#39;_ih&#39;</span><span class="p">,</span> <span class="s1">&#39;_ii&#39;</span><span class="p">,</span> <span class="s1">&#39;_iii&#39;</span><span class="p">,</span> <span class="s1">&#39;_oh&#39;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a variable name looks like an ipython output cell, e.g.</span>
<span class="sd">    &quot;_49&quot;, &quot;_&quot;, or &quot;__&quot;.</span>

<span class="sd">    Ported from htools to avoid extra dependency.</span>

<span class="sd">    More examples:</span>
<span class="sd">    Returns True for names like (technically not sure if something like &quot;__i3&quot;</span>
<span class="sd">    is actually used in ipython, but it looks like something we probably want</span>
<span class="sd">    to remove in these contexts anyway /shrug):</span>
<span class="sd">    [&#39;_&#39;, &#39;__&#39;, &#39;_i3&#39;, &#39;__i3&#39;, &#39;_4&#39;, &#39;_9913&#39;, &#39;__7&#39;, &#39;__23874&#39;]</span>

<span class="sd">    Returns False for names like</span>
<span class="sd">    [&#39;_a&#39;, &#39;i22&#39;, &#39;__0i&#39;, &#39;_03z&#39;, &#39;__99t&#39;]</span>
<span class="sd">    and most &quot;normal&quot; variable names.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">    count_as_true: Iterable[str]</span>
<span class="sd">        Additional variable names that don&#39;t necessarily fit the standard</span>
<span class="sd">        pattern but should nonetheless return True if we encounter them.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool: True if it looks like an ipython output cell name, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First check if it fits the standard leading underscore format.</span>
    <span class="c1"># Easier to handle the &quot;only underscores&quot; case separately because we want</span>
    <span class="c1"># to limit the number of underscores for names like &quot;_i3&quot;.</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="s1">&#39;^_{1,2}i?</span><span class="se">\\</span><span class="s1">d*$&#39;</span>
    <span class="n">is_under</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">is_under</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">count_as_true</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.load_current_ipython_session" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_current_ipython_session</span><span class="p">(</span><span class="n">formatted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load current ipython session as a list and optionally convert it to a
nicely formatted str with each cell enclosed in triple backticks.</p>
<h4 id="lib.roboduck.utils.load_current_ipython_session--parameters">Parameters</h4>

<details class="formatted">
  <summary>bool</summary>
  <p>If True, format list of cells into a single str like:</p>
<div class="highlight"><pre><span></span><code>print(&#39;This is cell 1 code.&#39;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>print(&#39;This is cell 2 code.&#39;)
</code></pre></div>
<p>If False, leave it as a list of strings where each string contains
content from one cell.</p>
</details>      <h4 id="lib.roboduck.utils.load_current_ipython_session--returns">Returns</h4>
<p>list or str</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_current_ipython_session</span><span class="p">(</span><span class="n">formatted</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load current ipython session as a list and optionally convert it to a</span>
<span class="sd">    nicely formatted str with each cell enclosed in triple backticks.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    formatted: bool</span>
<span class="sd">        If True, format list of cells into a single str like:</span>

<span class="sd">        ```</span>
<span class="sd">        print(&#39;This is cell 1 code.&#39;)</span>
<span class="sd">        ```</span>

<span class="sd">        ```</span>
<span class="sd">        print(&#39;This is cell 2 code.&#39;)</span>
<span class="sd">        ```</span>

<span class="sd">        If False, leave it as a list of strings where each string contains</span>
<span class="sd">        content from one cell.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list or str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="si">}</span><span class="s1">.txt&#39;</span>
    <span class="n">shell</span><span class="o">.</span><span class="n">magic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%history -n -f </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">formatted</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;```</span><span class="se">\n</span><span class="si">{</span><span class="n">cell</span><span class="si">}</span><span class="se">\n</span><span class="s1">```&#39;</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cells</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.load_ipynb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_ipynb</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">save_if_self</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Loads ipynb and formats cells into 1 big string.</p>
<p>Adapted from htools.cli.ReadmeUpdater method.</p>
<h4 id="lib.roboduck.utils.load_ipynb--parameters">Parameters</h4>

<details class="path">
  <summary>Path</summary>
  <p>Path to notebook to load.</p>
</details>
<details class="save_if_self">
  <summary>bool</summary>
  <p>If True, check if this is being called from the current notebook. If
so, save it. (If not, we never save - auto saving is only intended to
address the scenario where we're in an active notebook and call this
function before recent changes have been saved. The load_ipynb call
itself means that at least 1 change has inevitably occurred since
saving.)</p>
</details>      <h4 id="lib.roboduck.utils.load_ipynb--returns">Returns</h4>
<p>str: Code contents of notebook. Each cell is enclosed in triple backticks
and separated by newlines.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_ipynb</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">save_if_self</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads ipynb and formats cells into 1 big string.</span>

<span class="sd">    Adapted from htools.cli.ReadmeUpdater method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: Path</span>
<span class="sd">        Path to notebook to load.</span>
<span class="sd">    save_if_self: bool</span>
<span class="sd">        If True, check if this is being called from the current notebook. If</span>
<span class="sd">        so, save it. (If not, we never save - auto saving is only intended to</span>
<span class="sd">        address the scenario where we&#39;re in an active notebook and call this</span>
<span class="sd">        function before recent changes have been saved. The load_ipynb call</span>
<span class="sd">        itself means that at least 1 change has inevitably occurred since</span>
<span class="sd">        saving.)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str: Code contents of notebook. Each cell is enclosed in triple backticks</span>
<span class="sd">    and separated by newlines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">save_if_self</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self_path</span> <span class="o">=</span> <span class="n">ipynbname</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self_path</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">save_notebook</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span>

    <span class="n">cell_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]:</span> <span class="k">continue</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">```&#39;</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s1">&#39;```</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">cell_str</span> <span class="o">+=</span> <span class="n">source</span>
    <span class="k">return</span> <span class="n">cell_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.load_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load a yaml file. Useful for loading prompts.</p>
<p>Borrowed from jabberwocky.</p>
<h4 id="lib.roboduck.utils.load_yaml--parameters">Parameters</h4>
<p>path: str or Path</p>

<details class="section">
  <summary>str or None</summary>
  <p>I vaguely recall yaml files can define different subsections. This lets
you return a specific one if you want. Usually leave as None which
returns the whole contents.</p>
</details>      <h4 id="lib.roboduck.utils.load_yaml--returns">Returns</h4>
<p>dict</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a yaml file. Useful for loading prompts.</span>

<span class="sd">    Borrowed from jabberwocky.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str or Path</span>
<span class="sd">    section: str or None</span>
<span class="sd">        I vaguely recall yaml files can define different subsections. This lets</span>
<span class="sd">        you return a specific one if you want. Usually leave as None which</span>
<span class="sd">        returns the whole contents.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.parse_completion" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_completion</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function is called on the gpt completion text in
roboduck.debug.DuckDB.ask_language_model (i.e. when the user asks a
question during a debugging session, or when an error occurs when in
auto-explain errors mode).</p>
<p>Users can define their own custom function as a replacement (mostly
useful when defining custom prompts too). The only requirements are that
the function must take 1 string input and return a dict containing the
keys "explanation" and "code", with an optional key "extra" that can be
used to store any additional information (probably in a dict). For example,
if you wrote a prompt that asked gpt to return valid json, you could
potentially use json.loads() as your drop-in replacement (ignoring
validation/error handling, which you might prefer to handle via a langchain
chain anyway).</p>
<h4 id="lib.roboduck.utils.parse_completion--parameters">Parameters</h4>

<details class="text">
  <summary>str</summary>
  <p>GPT completion. This should contain both a natural language explanation
and code.</p>
</details>      <h4 id="lib.roboduck.utils.parse_completion--returns">Returns</h4>
<p>dict[str]</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_completion</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is called on the gpt completion text in</span>
<span class="sd">    roboduck.debug.DuckDB.ask_language_model (i.e. when the user asks a</span>
<span class="sd">    question during a debugging session, or when an error occurs when in</span>
<span class="sd">    auto-explain errors mode).</span>

<span class="sd">    Users can define their own custom function as a replacement (mostly</span>
<span class="sd">    useful when defining custom prompts too). The only requirements are that</span>
<span class="sd">    the function must take 1 string input and return a dict containing the</span>
<span class="sd">    keys &quot;explanation&quot; and &quot;code&quot;, with an optional key &quot;extra&quot; that can be</span>
<span class="sd">    used to store any additional information (probably in a dict). For example,</span>
<span class="sd">    if you wrote a prompt that asked gpt to return valid json, you could</span>
<span class="sd">    potentially use json.loads() as your drop-in replacement (ignoring</span>
<span class="sd">    validation/error handling, which you might prefer to handle via a langchain</span>
<span class="sd">    chain anyway).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text: str</span>
<span class="sd">        GPT completion. This should contain both a natural language explanation</span>
<span class="sd">        and code.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict[str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Keep an eye out for how this performs - considered going with a more</span>
    <span class="c1"># complex regex or other approach here but since part 2 is supposed to be</span>
    <span class="c1"># code only, maybe that&#39;s okay. Extract_code could get weird if gpt</span>
    <span class="c1"># uses triple backticks in a function docstring but that should be very</span>
    <span class="c1"># rare, and the instructions sort of discourage it.</span>
    <span class="n">explanation</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">```&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">extract_code</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="n">explanation</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.save_notebook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_notebook</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Save a jupyter notebook. We use this in load_ipynb (optionally) to
ensure that when we load a notebook's source
code, we get the most up to date version. Adapted from
https://stackoverflow.com/questions/32237275/save-an-ipython-notebook-programmatically-from-within-itself/57814673#57814673</p>
<h4 id="lib.roboduck.utils.save_notebook--parameters">Parameters</h4>

<details class="file_path">
  <summary>str</summary>
  <p>Path to notebook that you want to save.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_notebook</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a jupyter notebook. We use this in load_ipynb (optionally) to</span>
<span class="sd">    ensure that when we load a notebook&#39;s source</span>
<span class="sd">    code, we get the most up to date version. Adapted from</span>
<span class="sd">    https://stackoverflow.com/questions/32237275/save-an-ipython-notebook-programmatically-from-within-itself/57814673#57814673</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path: str</span>
<span class="sd">        Path to notebook that you want to save.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">file_md5</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">start_md5</span> <span class="o">=</span> <span class="n">file_md5</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="s1">&#39;IPython.notebook.save_checkpoint();&#39;</span><span class="p">))</span>
    <span class="n">current_md5</span> <span class="o">=</span> <span class="n">start_md5</span>

    <span class="k">while</span> <span class="n">start_md5</span> <span class="o">==</span> <span class="n">current_md5</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">current_md5</span> <span class="o">=</span> <span class="n">file_md5</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.store_class_defaults" class="doc doc-heading">
<code class="highlight language-python"><span class="n">store_class_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Class decorator that stores default values of class attributes (can be
all or a subset). Default here refers to the value at class definition
time.</p>
<p>@store_class_defaults(attr_filter=lambda x: x.startswith('last_'))</p>

<details class="class-foo">
  <summary>class Foo</summary>
  <p>last_bar = 3
last_baz = 'abc'
other = True</p>
</details>      <blockquote>
<blockquote>
<blockquote>
<p>Foo._class_defaults</p>
</blockquote>
</blockquote>
</blockquote>
<p>{'last_bar': 3, 'last_baz': 'abc'}</p>
<p>Or use the decorator without parentheses to store all values at definition
time. This is usually unnecessary. If you do provide an attr_filter, it
must be a named argument.</p>
<p>Foo.reset_class_vars() will reset all relevant class vars to their
default values.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">store_class_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class decorator that stores default values of class attributes (can be</span>
<span class="sd">    all or a subset). Default here refers to the value at class definition</span>
<span class="sd">    time.</span>

<span class="sd">    @store_class_defaults(attr_filter=lambda x: x.startswith(&#39;last_&#39;))</span>
<span class="sd">    class Foo:</span>
<span class="sd">        last_bar = 3</span>
<span class="sd">        last_baz = &#39;abc&#39;</span>
<span class="sd">        other = True</span>

<span class="sd">    &gt;&gt;&gt; Foo._class_defaults</span>

<span class="sd">    {&#39;last_bar&#39;: 3, &#39;last_baz&#39;: &#39;abc&#39;}</span>

<span class="sd">    Or use the decorator without parentheses to store all values at definition</span>
<span class="sd">    time. This is usually unnecessary. If you do provide an attr_filter, it</span>
<span class="sd">    must be a named argument.</span>

<span class="sd">    Foo.reset_class_vars() will reset all relevant class vars to their</span>
<span class="sd">    default values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">store_class_defaults</span><span class="p">,</span> <span class="n">attr_filter</span><span class="o">=</span><span class="n">attr_filter</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;cls arg in store_class_defaults decorator has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;but expected type `type`, i.e. a class. You may be passing in &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;an attr_filter as a positional arg which is not allowed - it &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;must be a named arg if provided.&#39;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">attr_filter</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">attr_filter</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">attr_filter</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_class_defaults&#39;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Class </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s1"> already has attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">. store_class_defaults &#39;</span>
            <span class="s1">&#39;decorator would overwrite that. Exiting.&#39;</span>
        <span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">reset_class_vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset all default class attributes to their defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_class_defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not reset class attribute </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> to its &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;default value:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">meth_name</span> <span class="o">=</span> <span class="s1">&#39;reset_class_vars&#39;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Class </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s1"> already has attribute </span><span class="si">{</span><span class="n">meth_name</span><span class="si">}</span><span class="s1">. &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;store_class_defaults decorator would overwrite that. Exiting.&#39;</span>
        <span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">,</span> <span class="n">reset_class_vars</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.truncated_repr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truncated_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">79</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return an object's repr, truncated to ensure that it doesn't take up
more characters than we want. This is used to reduce our chances of using
up all our available tokens in a gpt prompt simply communicating that a
giant data structure exists, e.g. list(range(1_000_000)). Our use
case doesn't call for anything super precise so the max_len should be
thought of as more of guide than an exact max. I think it's enforced but I
didn't put a whole lot of thought or effort into confirming that.</p>
<h4 id="lib.roboduck.utils.truncated_repr--parameters">Parameters</h4>
<p>obj: any</p>

<details class="max_len">
  <summary>int</summary>
  <p>Max number of characters for resulting repr. Think of this more as an
estimate than a hard guarantee - precision isn't important in our use
case. The result will likely be shorter than this because we want to
truncate in a readable place, e.g. taking the repr of the first k items
of a list instead of taking the repr of all items and then slicing off
the end of the repr.</p>
</details>      <h4 id="lib.roboduck.utils.truncated_repr--returns">Returns</h4>
<p>str: Repr for obj, truncated to approximately max_len characters or fewer.
When possible, we insert ellipses into the repr to show that truncation
occurred. Technically there are some edge cases we don't handle (e.g. if
obj is a class with an insanely long name) but that's not a big deal, at
least at the moment. I can always revisit that later if necessary.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">truncated_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">79</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an object&#39;s repr, truncated to ensure that it doesn&#39;t take up</span>
<span class="sd">    more characters than we want. This is used to reduce our chances of using</span>
<span class="sd">    up all our available tokens in a gpt prompt simply communicating that a</span>
<span class="sd">    giant data structure exists, e.g. list(range(1_000_000)). Our use</span>
<span class="sd">    case doesn&#39;t call for anything super precise so the max_len should be</span>
<span class="sd">    thought of as more of guide than an exact max. I think it&#39;s enforced but I</span>
<span class="sd">    didn&#39;t put a whole lot of thought or effort into confirming that.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj: any</span>
<span class="sd">    max_len: int</span>
<span class="sd">        Max number of characters for resulting repr. Think of this more as an</span>
<span class="sd">        estimate than a hard guarantee - precision isn&#39;t important in our use</span>
<span class="sd">        case. The result will likely be shorter than this because we want to</span>
<span class="sd">        truncate in a readable place, e.g. taking the repr of the first k items</span>
<span class="sd">        of a list instead of taking the repr of all items and then slicing off</span>
<span class="sd">        the end of the repr.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str: Repr for obj, truncated to approximately max_len characters or fewer.</span>
<span class="sd">    When possible, we insert ellipses into the repr to show that truncation</span>
<span class="sd">    occurred. Technically there are some edge cases we don&#39;t handle (e.g. if</span>
<span class="sd">    obj is a class with an insanely long name) but that&#39;s not a big deal, at</span>
<span class="sd">    least at the moment. I can always revisit that later if necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">qualname</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Similar to type(obj).__qualname__() but that method doesn&#39;t always</span>
<span class="sd">        include the module(s). e.g. pandas Index has __qualname__ &quot;Index&quot; but</span>
<span class="sd">        this funnction returns &quot;&lt;pandas.core.indexes.base.Index&gt;&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;&lt;class &#39;([a-zA-Z_.]*)&#39;&gt;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Should have found only 1 qualname but &#39;</span> \
                                <span class="sa">f</span><span class="s1">&#39;found: </span><span class="si">{</span><span class="n">names</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&gt;&#39;</span>

    <span class="n">open2close</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;[&#39;</span><span class="p">:</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;(&#39;</span><span class="p">:</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;{&#39;</span><span class="p">:</span> <span class="s1">&#39;}&#39;</span>
    <span class="p">}</span>
    <span class="n">repr_</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_len</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">repr_</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">truncated_repr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">max_len</span> <span class="o">-</span> <span class="mi">26</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;pd.DataFrame(columns=&#39;</span> \
               <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">truncated_repr</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">22</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;pd.Series(</span><span class="si">{</span><span class="n">truncated_repr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">11</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="n">max_len</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">new_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">!r}</span><span class="s1">, &#39;</span>
            <span class="n">length</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_str</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">new_str</span>
        <span class="k">return</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;...}&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">repr_</span><span class="p">[:</span><span class="n">max_len</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&#39;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="c1"># A bit risky but sort of elegant. Just recursively take smaller</span>
        <span class="c1"># slices until we get an acceptable length. We may end up going</span>
        <span class="c1"># slightly over the max length after adding our ellipses but it&#39;s</span>
        <span class="c1"># not that big a deal, this isn&#39;t meant to be super precise. We</span>
        <span class="c1"># can also end up with fewer items than we could have fit - if we</span>
        <span class="c1"># exhaustively check every possible length one by one until we</span>
        <span class="c1"># find the max length that fits, we can get a very slow function</span>
        <span class="c1"># when inputs are long.</span>
        <span class="c1"># Can&#39;t easily pass smaller max_len value into recursive call</span>
        <span class="c1"># because we always want to compare to the user-specified value.</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_len</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="c1"># Even slicing to just first item is too long, so just revert</span>
            <span class="c1"># to treating this like a non-iterable object.</span>
            <span class="k">return</span> <span class="n">qualname</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># Need to slice set while keeping the original dtype.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">slice_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)[:</span><span class="n">n</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">slice_</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to slice obj </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">. Result may not be &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;truncated as much as desired. Error:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">slice_</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">repr_</span> <span class="o">=</span> <span class="n">truncated_repr</span><span class="p">(</span><span class="n">slice_</span><span class="p">,</span> <span class="n">max_len</span><span class="p">)</span>
        <span class="n">non_brace_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">repr_</span><span class="p">[</span><span class="n">non_brace_idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">open2close</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">non_brace_idx</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">non_brace_idx</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">non_brace_idx</span> <span class="o">==</span> <span class="mi">3</span>
                                  <span class="ow">and</span> <span class="n">repr_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">repr_</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span> <span class="o">+</span> <span class="n">repr_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">repr_</span><span class="p">[:</span><span class="n">non_brace_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,...&#39;</span> <span class="o">+</span> <span class="n">repr_</span><span class="p">[</span><span class="n">non_brace_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># We know it&#39;s non-iterable at this point.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;class </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&gt;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">truncated_repr</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;.3e&#39;</span><span class="p">),</span> <span class="n">max_len</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qualname</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.type_annotated_dict_str" class="doc doc-heading">
<code class="highlight language-python"><span class="n">type_annotated_dict_str</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="nb">repr</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>String representation (or repr) of a dict, where each line includes
an inline comment showing the type of the value.</p>
<h4 id="lib.roboduck.utils.type_annotated_dict_str--parameters">Parameters</h4>

<details class="dict_">
  <summary>dict</summary>
  <p>The dict to represent.</p>
</details>
<details class="func">
  <summary>function</summary>
  <p>The function to apply to each key and value in the dict to get some
kind of str representation. Note that it is applied to each key/value
as a whole, not to each item within that key/value. For example, notice
below how foo and cat are not in quotes but ('bar',) and ['x'] do
contain quotes.</p>
<blockquote>
<blockquote>
<blockquote>
<p>d = {'foo': 'cat', ('bar',): ['x']}
type_annotated_dict_str(d, str)
{
    foo: cat,   # type: str
    ('bar',): ['x'],   # type: list
}</p>
</blockquote>
</blockquote>
</blockquote>
</details>      <h4 id="lib.roboduck.utils.type_annotated_dict_str--returns">Returns</h4>
<p>str</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">type_annotated_dict_str</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="nb">repr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;String representation (or repr) of a dict, where each line includes</span>
<span class="sd">    an inline comment showing the type of the value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dict_: dict</span>
<span class="sd">        The dict to represent.</span>
<span class="sd">    func: function</span>
<span class="sd">        The function to apply to each key and value in the dict to get some</span>
<span class="sd">        kind of str representation. Note that it is applied to each key/value</span>
<span class="sd">        as a whole, not to each item within that key/value. For example, notice</span>
<span class="sd">        below how foo and cat are not in quotes but (&#39;bar&#39;,) and [&#39;x&#39;] do</span>
<span class="sd">        contain quotes.</span>

<span class="sd">        &gt;&gt;&gt; d = {&#39;foo&#39;: &#39;cat&#39;, (&#39;bar&#39;,): [&#39;x&#39;]}</span>
<span class="sd">        &gt;&gt;&gt; type_annotated_dict_str(d, str)</span>
<span class="sd">        {</span>
<span class="sd">            foo: cat,   # type: str</span>
<span class="sd">            (&#39;bar&#39;,): [&#39;x&#39;],   # type: list</span>
<span class="sd">        }</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">type_strs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    </span><span class="si">{</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">func</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1">,   # type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span>
                 <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">return</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">type_strs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.utils.typecheck" class="doc doc-heading">
<code class="highlight language-python"><span class="n">typecheck</span><span class="p">(</span><span class="n">func_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">types</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Decorator to enforce type checking for a function or method. There are
two ways to call this: either explicitly passing argument types to the
decorator, or letting it infer them using type annotations in the function
that will be decorated. We allow multiple both usage methods since older
versions of Python lack type annotations, and also because I feel the
annotation syntax can hurt readability.</p>
<p>Ported from htools to avoid extra dependency.</p>
<h4 id="lib.roboduck.utils.typecheck--parameters">Parameters</h4>

<details class="func_">
  <summary>function</summary>
  <p>The function to decorate. When using decorator with
manually-specified types, this is None. Underscore is used so that
<code>func</code> can still be used as a valid keyword argument for the wrapped
function.</p>
</details>
<details class="types">
  <summary>type</summary>
  <p>Optional way to specify variable types. Use standard types rather than
importing from the typing library, as subscripted generics are not
supported (e.g. typing.List[str] will not work; typing.List will but at
that point there is no benefit over the standard <code>list</code>).</p>
</details>      <h4 id="lib.roboduck.utils.typecheck--examples">Examples</h4>
<p>In the first example, we specify types directly in the decorator. Notice
that they can be single types or tuples of types. You can choose to
specify types for all arguments or just a subset.</p>
<div class="highlight"><pre><span></span><code>@typecheck(x=float, y=(int, float), iters=int, verbose=bool)
def process(x, y, z, iters=5, verbose=True):
    print(f&#39;z = {z}&#39;)
    for i in range(iters):
        if verbose: print(f&#39;Iteration {i}...&#39;)
        x *= y
    return x
</code></pre></div>
<blockquote>
<blockquote>
<blockquote>
<p>process(3.1, 4.5, 0, 2.0)
TypeError: iters must be <class 'int'>, not <class 'float'>.</p>
<p>process(3.1, 4, 'a', 1, False)
z = a
12.4</p>
</blockquote>
</blockquote>
</blockquote>
<p>Alternatively, you can let the decorator infer types using annotations
in the function that is to be decorated. The example below behaves
equivalently to the explicit example shown above. Note that annotations
regarding the returned value are ignored.</p>
<div class="highlight"><pre><span></span><code>@typecheck
def process(x:float, y:(int, float), z, iters:int=5, verbose:bool=True):
    print(f&#39;z = {z}&#39;)
    for i in range(iters):
        if verbose: print(f&#39;Iteration {i}...&#39;)
        x *= y
    return x
</code></pre></div>
<blockquote>
<blockquote>
<blockquote>
<p>process(3.1, 4.5, 0, 2.0)
TypeError: iters must be <class 'int'>, not <class 'float'>.</p>
<p>process(3.1, 4, 'a', 1, False)
z = a
12.4</p>
</blockquote>
</blockquote>
</blockquote>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">typecheck</span><span class="p">(</span><span class="n">func_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">types</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to enforce type checking for a function or method. There are</span>
<span class="sd">    two ways to call this: either explicitly passing argument types to the</span>
<span class="sd">    decorator, or letting it infer them using type annotations in the function</span>
<span class="sd">    that will be decorated. We allow multiple both usage methods since older</span>
<span class="sd">    versions of Python lack type annotations, and also because I feel the</span>
<span class="sd">    annotation syntax can hurt readability.</span>

<span class="sd">    Ported from htools to avoid extra dependency.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func_: function</span>
<span class="sd">        The function to decorate. When using decorator with</span>
<span class="sd">        manually-specified types, this is None. Underscore is used so that</span>
<span class="sd">        `func` can still be used as a valid keyword argument for the wrapped</span>
<span class="sd">        function.</span>
<span class="sd">    types: type</span>
<span class="sd">        Optional way to specify variable types. Use standard types rather than</span>
<span class="sd">        importing from the typing library, as subscripted generics are not</span>
<span class="sd">        supported (e.g. typing.List[str] will not work; typing.List will but at</span>
<span class="sd">        that point there is no benefit over the standard `list`).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In the first example, we specify types directly in the decorator. Notice</span>
<span class="sd">    that they can be single types or tuples of types. You can choose to</span>
<span class="sd">    specify types for all arguments or just a subset.</span>

<span class="sd">    ```</span>
<span class="sd">    @typecheck(x=float, y=(int, float), iters=int, verbose=bool)</span>
<span class="sd">    def process(x, y, z, iters=5, verbose=True):</span>
<span class="sd">        print(f&#39;z = {z}&#39;)</span>
<span class="sd">        for i in range(iters):</span>
<span class="sd">            if verbose: print(f&#39;Iteration {i}...&#39;)</span>
<span class="sd">            x *= y</span>
<span class="sd">        return x</span>
<span class="sd">    ```</span>

<span class="sd">    &gt;&gt;&gt; process(3.1, 4.5, 0, 2.0)</span>
<span class="sd">    TypeError: iters must be &lt;class &#39;int&#39;&gt;, not &lt;class &#39;float&#39;&gt;.</span>

<span class="sd">    &gt;&gt;&gt; process(3.1, 4, &#39;a&#39;, 1, False)</span>
<span class="sd">    z = a</span>
<span class="sd">    12.4</span>

<span class="sd">    Alternatively, you can let the decorator infer types using annotations</span>
<span class="sd">    in the function that is to be decorated. The example below behaves</span>
<span class="sd">    equivalently to the explicit example shown above. Note that annotations</span>
<span class="sd">    regarding the returned value are ignored.</span>

<span class="sd">    ```</span>
<span class="sd">    @typecheck</span>
<span class="sd">    def process(x:float, y:(int, float), z, iters:int=5, verbose:bool=True):</span>
<span class="sd">        print(f&#39;z = {z}&#39;)</span>
<span class="sd">        for i in range(iters):</span>
<span class="sd">            if verbose: print(f&#39;Iteration {i}...&#39;)</span>
<span class="sd">            x *= y</span>
<span class="sd">        return x</span>
<span class="sd">    ```</span>

<span class="sd">    &gt;&gt;&gt; process(3.1, 4.5, 0, 2.0)</span>
<span class="sd">    TypeError: iters must be &lt;class &#39;int&#39;&gt;, not &lt;class &#39;float&#39;&gt;.</span>

<span class="sd">    &gt;&gt;&gt; process(3.1, 4, &#39;a&#39;, 1, False)</span>
<span class="sd">    z = a</span>
<span class="sd">    12.4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Case 1: Pass keyword args to decorator specifying types.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">func_</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">typecheck</span><span class="p">,</span> <span class="o">**</span><span class="n">types</span><span class="p">)</span>
    <span class="c1"># Case 2: Infer types from annotations. Skip if Case 1 already occurred.</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">types</span><span class="p">:</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">annotation</span>
                 <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">(</span><span class="n">func_</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                 <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">annotation</span> <span class="o">==</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">}</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func_</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fargs</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">arguments</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fargs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> must be </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1">, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">fargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="si">}</span><span class="s1">.&#39;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">func_</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51198bba.min.js"></script>
      
    
  </body>
</html>