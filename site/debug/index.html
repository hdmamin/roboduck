
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../errors/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>Debug - RoboDuck</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ded33207.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lib.roboduck.debug" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RoboDuck" class="md-header__button md-logo" aria-label="RoboDuck" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RoboDuck
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Debug
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RoboDuck" class="md-nav__button md-logo" aria-label="RoboDuck" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RoboDuck
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Debug
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Debug
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug" class="md-nav__link">
    lib.roboduck.debug
  </a>
  
    <nav class="md-nav" aria-label="lib.roboduck.debug">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug--quickstart" class="md-nav__link">
    Quickstart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug.CodeCompletionCache" class="md-nav__link">
    CodeCompletionCache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB" class="md-nav__link">
    DuckDB
  </a>
  
    <nav class="md-nav" aria-label="DuckDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.__init__" class="md-nav__link">
    __init__()
  </a>
  
    <nav class="md-nav" aria-label="__init__()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.__init__--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.ask_language_model" class="md-nav__link">
    ask_language_model()
  </a>
  
    <nav class="md-nav" aria-label="ask_language_model()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.ask_language_model--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.field_names" class="md-nav__link">
    field_names()
  </a>
  
    <nav class="md-nav" aria-label="field_names()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.field_names--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.onecmd" class="md-nav__link">
    onecmd()
  </a>
  
    <nav class="md-nav" aria-label="onecmd()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.onecmd--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.precmd" class="md-nav__link">
    precmd()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.print_stack_entry" class="md-nav__link">
    print_stack_entry()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug.duck" class="md-nav__link">
    duck()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../magic/" class="md-nav__link">
        Magic
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/cli/" class="md-nav__link">
        TODO: not working. Also tried leading ".." but that throws empty import error.
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        Shell
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ipy_utils/" class="md-nav__link">
        IPython utils
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        Decorators
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug" class="md-nav__link">
    lib.roboduck.debug
  </a>
  
    <nav class="md-nav" aria-label="lib.roboduck.debug">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug--quickstart" class="md-nav__link">
    Quickstart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug.CodeCompletionCache" class="md-nav__link">
    CodeCompletionCache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB" class="md-nav__link">
    DuckDB
  </a>
  
    <nav class="md-nav" aria-label="DuckDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.__init__" class="md-nav__link">
    __init__()
  </a>
  
    <nav class="md-nav" aria-label="__init__()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.__init__--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.ask_language_model" class="md-nav__link">
    ask_language_model()
  </a>
  
    <nav class="md-nav" aria-label="ask_language_model()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.ask_language_model--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.field_names" class="md-nav__link">
    field_names()
  </a>
  
    <nav class="md-nav" aria-label="field_names()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.field_names--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.onecmd" class="md-nav__link">
    onecmd()
  </a>
  
    <nav class="md-nav" aria-label="onecmd()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.onecmd--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.precmd" class="md-nav__link">
    precmd()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.debug.DuckDB.print_stack_entry" class="md-nav__link">
    print_stack_entry()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.debug.duck" class="md-nav__link">
    duck()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Debug</h1>

<div class="doc doc-object doc-module">


<a id="lib.roboduck.debug"></a>
  <div class="doc doc-contents first">
  
      <p>A conversational debugger and drop-in replacement for pdb. Python's default
interactive debugging session is already a crude conversation with your
program or interpreter, in a sense - this just lets your program communicate to
you more effectively.</p>
<h3 id="lib.roboduck.debug--quickstart">Quickstart</h3>
<p>Here's a broken version of bubble sort that places a <code>duck()</code> call on the
second to last line where you might normally call <code>breakpoint()</code>.</p>
<div class="highlight"><pre><span></span><code>from roboduck.debug import duck

def bubble_sort(nums):
    for i in range(len(nums)):
        for j in range(len(nums)):
            if nums[j] &gt; nums[j + 1]:
                nums[j + 1], nums[j] = nums[j], nums[j + 1]
                duck()   # &lt;--------------------------- instead of breakpoint()
    return nums
</code></pre></div>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="lib.roboduck.debug.CodeCompletionCache" class="doc doc-heading">
        <code>CodeCompletionCache</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Just stores the last completion from DuckDB in a way that our
<code>duck</code> jupyter magic can access (without relying on global variable, though
not sure if this is meaningfully different). The magic only needs to access
it in insert mode (-i flag) to insert the fixed code snippet into a new
code cell.</p>


        <details class="quote">
          <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@store_class_defaults</span><span class="p">(</span><span class="n">attr_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;last_&#39;</span><span class="p">))</span>
<span class="k">class</span> <span class="nc">CodeCompletionCache</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Just stores the last completion from DuckDB in a way that our</span>
<span class="sd">    `duck` jupyter magic can access (without relying on global variable, though</span>
<span class="sd">    not sure if this is meaningfully different). The magic only needs to access</span>
<span class="sd">    it in insert mode (-i flag) to insert the fixed code snippet into a new</span>
<span class="sd">    code cell.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_completion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">last_explanation</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">last_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">last_new_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">last_code_diff</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">last_extra</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="lib.roboduck.debug.DuckDB" class="doc doc-heading">
        <code>DuckDB</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="pdb.Pdb">Pdb</span></code></p>

  
      <p>Conversational debugger powered by gpt models (currently codex, possibly
eventually chatGPT). Once you're in a debugging session, any user command
containing a question mark will be interpreted as a question for gpt.
Prefixing your question with "[dev]" will print out the full prompt before
making the query.</p>


        <details class="quote">
          <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DuckDB</span><span class="p">(</span><span class="n">Pdb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Conversational debugger powered by gpt models (currently codex, possibly</span>
<span class="sd">    eventually chatGPT). Once you&#39;re in a debugging session, any user command</span>
<span class="sd">    containing a question mark will be interpreted as a question for gpt.</span>
<span class="sd">    Prefixing your question with &quot;[dev]&quot; will print out the full prompt before</span>
<span class="sd">    making the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt_name</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">max_len_per_var</span><span class="o">=</span><span class="mi">79</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">pdb_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_func</span><span class="o">=</span><span class="n">parse_completion</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">chat_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prompt_name: str</span>
<span class="sd">            Name of prompt template to use when querying chatGPT. Roboduck</span>
<span class="sd">            currently provides several builtin options</span>
<span class="sd">            (see roboduck.prompts.chat):</span>
<span class="sd">                debug - for interactive debugging sessions on the relevant</span>
<span class="sd">                    snippet of code.</span>
<span class="sd">                debug_full - for interactive debugging sessions on the whole</span>
<span class="sd">                    notebook (no difference from &quot;debug&quot; for scripts). Risks</span>
<span class="sd">                    creating a context that is too long.</span>
<span class="sd">                debug_stack_trace - for automatic error explanations or</span>
<span class="sd">                    logging.</span>
<span class="sd">            Alternatively, can also define your own template in a yaml file</span>
<span class="sd">            mimicking the format of the builtin templates and pass in the</span>
<span class="sd">            path to that file as a string.</span>
<span class="sd">        max_len_per_var: int</span>
<span class="sd">            Limits number of characters per variable when communicating</span>
<span class="sd">            current state (local or global depending on `full_context`) to</span>
<span class="sd">            gpt. If unbounded, that section of the prompt alone could grow</span>
<span class="sd">            very big . I somewhat arbitrarily set 79 as the default, i.e.</span>
<span class="sd">            1 line of python per variable. I figure that&#39;s usually enough to</span>
<span class="sd">            communicate the gist of what&#39;s happening.</span>
<span class="sd">        silent: bool</span>
<span class="sd">            If True, print gpt completions to stdout. One example of when False</span>
<span class="sd">            is appropriate is our logging module - we want to get the</span>
<span class="sd">            explanation and update the exception message which then gets</span>
<span class="sd">            logged, but we don&#39;t care about typing results in real time.</span>
<span class="sd">        pdb_kwargs: dict or None</span>
<span class="sd">            Additional kwargs for base Pdb class.</span>
<span class="sd">        parse_func: function</span>
<span class="sd">            This will be called on the generated text each time gpt provides a</span>
<span class="sd">            completion. It returns a dictionary whose values will be stored</span>
<span class="sd">            in CodeCompletionCache in this module. See the default function&#39;s</span>
<span class="sd">            docstring for guidance on writing a custom function.</span>
<span class="sd">        color: str</span>
<span class="sd">            Color to print gpt completions in. Sometimes we want to change this</span>
<span class="sd">            to red, such as in the errors module, to make it clearer that an</span>
<span class="sd">            error occurred.</span>
<span class="sd">        chat_kwargs: any</span>
<span class="sd">            Additional kwargs to configure our Chat class (passed to</span>
<span class="sd">            its `from_config` factory). Common example would be setting</span>
<span class="sd">            `chat_class=roboduck.langchain.chat.DummyChatModel`</span>
<span class="sd">            which mocks api calls (good for development, saves money).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">pdb_kwargs</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;&gt;&gt;&gt; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duck_prompt</span> <span class="o">=</span> <span class="s1">&#39;[Duck] &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_name</span>
        <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;streaming&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;streaming&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;callback_manager&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CallbackManager</span><span class="p">(</span>
                <span class="p">[</span><span class="n">LiveTypingCallbackHandler</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)]</span>
            <span class="p">)</span>
        <span class="c1"># Dev color is what we print the prompt in when user asks a question</span>
        <span class="c1"># in dev mode.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dev_color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;red&#39;</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
        <span class="c1"># Must create self.chat before setting _chat_prompt_keys,</span>
        <span class="c1"># and full_context after both of those.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chat</span> <span class="o">=</span> <span class="n">Chat</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="o">**</span><span class="n">chat_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_user_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_user_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_prompt_keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_context</span> <span class="o">=</span> <span class="s1">&#39;full_code&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_name</span> <span class="o">=</span> <span class="n">prompt_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repr_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">truncated_repr</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="n">max_len_per_var</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_func</span> <span class="o">=</span> <span class="n">parse_func</span>
        <span class="c1"># This gets updated every time the user asks a question.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_kwargs_hash</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_chat_prompt_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve default and backup user reply prompt keys (names) from</span>
<span class="sd">        self.chat object. If the prompt template has only one reply type,</span>
<span class="sd">        the backup key will equal the default key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">user_templates</span><span class="p">)</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">backup</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s1">&#39;You</span><span class="se">\&#39;</span><span class="s1">re using a chat prompt template with &gt;2 types or &#39;</span>
                    <span class="s1">&#39;user replies. This is not recommended because it</span><span class="se">\&#39;</span><span class="s1">s &#39;</span>
                    <span class="s1">&#39;not clear how to determine which reply type to use. We &#39;</span>
                    <span class="s1">&#39;arbitrarily choose the first non-default key as the &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;backup reply type (&quot;</span><span class="si">{</span><span class="n">backup</span><span class="si">}</span><span class="s1">&quot;).&#39;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">default</span><span class="p">,</span> <span class="n">backup</span>

    <span class="k">def</span> <span class="nf">field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names of variables that are expected to be passed into default</span>
<span class="sd">        user prompt template.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        set[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">input_variables</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_snippet</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve next line of code that will be executed. Must call this</span>
<span class="sd">        before we remove the duck() call.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        code_snippet: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">code_snippet</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">max_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Adjust f_lineno because it&#39;s 1 - indexed by default.</span>
        <span class="c1"># Set default next_line in case we don&#39;t find any valid line.</span>
        <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curframe</span><span class="o">.</span><span class="n">f_lineno</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">next_line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="n">line_no</span> <span class="o">&lt;=</span> <span class="n">max_idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">line_no</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;duck(&#39;</span><span class="p">):</span>
                <span class="n">line_no</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">line_no</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">next_line</span>

    <span class="k">def</span> <span class="nf">_get_prompt_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a dictionary describing the current state of our code</span>
<span class="sd">        (variable names and values, source code, file type). This will be</span>
<span class="sd">        passed to our langchain chat.reply() method to fill in the debug prompt</span>
<span class="sd">        template.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict: contains keys &#39;code&#39;, &#39;local_vars&#39;, &#39;global_vars&#39;, &#39;file_type&#39;.</span>
<span class="sd">        If we specified full_context=True on init, we also include the key</span>
<span class="sd">        &#39;full_code&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get current code snippet.</span>
        <span class="c1"># Fails when running code from cmd line like:</span>
        <span class="c1"># &#39;python -c &quot;print(x)&quot;&#39;.</span>
        <span class="c1"># Haven&#39;t been able to find a way around this yet.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Find next line before removing duck call to avoid messing up our</span>
            <span class="c1"># index.</span>
            <span class="n">code_snippet</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curframe</span><span class="p">)</span>
            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;next_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_next_line</span><span class="p">(</span><span class="n">code_snippet</span><span class="p">)</span>
            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_debugger_call</span><span class="p">(</span><span class="n">code_snippet</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;local_vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_annotated_dict_str</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">curframe_locals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
             <span class="k">if</span> <span class="ow">not</span> <span class="n">is_ipy_name</span><span class="p">(</span><span class="n">k</span><span class="p">)},</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repr_func</span>
        <span class="p">)</span>

        <span class="c1"># Get full source code if necessary.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_context</span><span class="p">:</span>
            <span class="c1"># File is a string, either a file name or something like</span>
            <span class="c1"># &lt;ipython-input-50-e97ed612f523&gt;.</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcefile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curframe</span><span class="o">.</span><span class="n">f_code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;ipython&#39;</span><span class="p">):</span>
                <span class="c1"># If we&#39;re in ipython, ipynbname.path() throws a</span>
                <span class="c1"># FileNotFoundError.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">full_code</span> <span class="o">=</span> <span class="n">load_ipynb</span><span class="p">(</span><span class="n">ipynbname</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;file_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jupyter notebook&#39;</span>
                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="c1"># TODO: maybe ipython session needs to use a modified</span>
                    <span class="c1"># version of this func regardless of self.full_context,</span>
                    <span class="c1"># and should return full code as list initially and</span>
                    <span class="c1"># override res[&#39;code&#39;] with last executed cell. Otherwise</span>
                    <span class="c1"># I think getsource(curframe) may load a lot more code than</span>
                    <span class="c1"># we usually want in ipython session.</span>
                    <span class="n">full_code</span> <span class="o">=</span> <span class="n">load_current_ipython_session</span><span class="p">()</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;file_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ipython session&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">full_code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">res</span><span class="p">[</span><span class="s1">&#39;file_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;python script&#39;</span>
            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;full_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_debugger_call</span><span class="p">(</span><span class="n">full_code</span><span class="p">)</span>
            <span class="n">used_tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;full_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is intentionally different from the used_tokens line in the</span>
            <span class="c1"># if clause - we only want to consider local code here.</span>
            <span class="n">used_tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="c1"># Namespace is often polluted with lots of unused globals (htools is</span>
        <span class="c1"># very much guilty of this 😬) and we don&#39;t want to clutter up the</span>
        <span class="c1"># prompt with these.</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;global_vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_annotated_dict_str</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">curframe</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
             <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">used_tokens</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_ipy_name</span><span class="p">(</span><span class="n">k</span><span class="p">)},</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repr_func</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_debugger_call</span><span class="p">(</span><span class="n">code_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove `duck` function call (our equivalent of `breakpoint` from</span>
<span class="sd">        source code string. Including it introduces a slight risk that gpt</span>
<span class="sd">        will fixate on this mistery function as a potential bug cause.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">code_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                         <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;duck(&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">onecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Base class describes this as follows:</span>

<span class="sd">        Interpret the argument as though it had been typed in response to the</span>
<span class="sd">        prompt. Checks whether this line is typed at the normal prompt or in</span>
<span class="sd">        a breakpoint command list definition.</span>

<span class="sd">        We add an extra check in the if block to check if the user asked a</span>
<span class="sd">        question. If so, we ask gpt. If not, we treat it as a regular pdb</span>
<span class="sd">        command.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line: str or tuple</span>
<span class="sd">            If str, this is a regular line like in the standard debugger.</span>
<span class="sd">            If tuple, this contains (line str, stack trace str - see</span>
<span class="sd">            roboduck.errors.post_mortem for the actual insertion into the</span>
<span class="sd">            cmdqueue). This is for use with the debug_stack_trace mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">line</span><span class="p">,</span> <span class="n">stack_trace</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stack_trace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands_defining</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_language_model</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span>
                    <span class="n">stack_trace</span><span class="o">=</span><span class="n">stack_trace</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[dev]&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Cmd</span><span class="o">.</span><span class="n">onecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_command_def</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ask_language_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">stack_trace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;When the user asks a question during a debugging session, query</span>
<span class="sd">        gpt for the answer and type it back to them live.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        question: str</span>
<span class="sd">            User question, e.g. &quot;Why are the first three values in nums equal</span>
<span class="sd">            to 5 when the input list only had a single 5?&quot;. (Example is from</span>
<span class="sd">            a faulty bubble sort implementation.)</span>
<span class="sd">        stack_trace: str</span>
<span class="sd">            When using the &quot;debug_stack_trace&quot; prompt, we need to pass a</span>
<span class="sd">            stack trace string into the prompt.</span>
<span class="sd">        verbose: bool</span>
<span class="sd">            If True, print the full gpt prompt in red before making the api</span>
<span class="sd">            call. User activates this mode by prefixing their question with</span>
<span class="sd">            &#39;[dev]&#39;. This overrides self.silent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Don&#39;t provide long context-laden prompt if nothing has changed since</span>
        <span class="c1"># the user&#39;s last question. This is often a followup/clarifying</span>
        <span class="c1"># question.</span>
        <span class="n">prompt_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_prompt_kwargs</span><span class="p">()</span>
        <span class="n">kwargs_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs_hash</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_kwargs_hash</span><span class="p">:</span>
            <span class="n">prompt_kwargs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">prompt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_user_key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prompt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_user_key</span>

        <span class="c1"># Perform surgery on kwargs depending on what fields are expected.</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">(</span><span class="n">prompt_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;question&#39;</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
            <span class="n">prompt_kwargs</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">question</span>
        <span class="k">if</span> <span class="n">stack_trace</span><span class="p">:</span>
            <span class="n">prompt_kwargs</span><span class="p">[</span><span class="s1">&#39;stack_trace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stack_trace</span>

        <span class="c1"># Validate that expected fields are present and provide interpretable</span>
        <span class="c1"># error message if not.</span>
        <span class="n">kwargs_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="p">)</span>
        <span class="n">only_in_kwargs</span> <span class="o">=</span> <span class="n">kwargs_names</span> <span class="o">-</span> <span class="n">field_names</span>
        <span class="n">only_in_expected</span> <span class="o">=</span> <span class="n">field_names</span> <span class="o">-</span> <span class="n">kwargs_names</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;If you are using a custom prompt, you may need to &#39;</span> \
                    <span class="s1">&#39;subclass roboduck.debug.DuckDB and override the &#39;</span> \
                    <span class="s1">&#39;_get_prompt_kwargs method.&#39;</span>
        <span class="k">if</span> <span class="n">only_in_kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Received unexpected kwarg(s): </span><span class="si">{</span><span class="n">only_in_kwargs</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s1"> &#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">only_in_expected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Missing required kwarg(s): </span><span class="si">{</span><span class="n">only_in_expected</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">user_message</span><span class="p">(</span><span class="n">key_</span><span class="o">=</span><span class="n">prompt_key</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">prompt_kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1_000</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Prompt is very long (&gt;1k words). You</span><span class="se">\&#39;</span><span class="s1">re approaching a risky&#39;</span>
                <span class="s1">&#39; zone where your prompt + completion might exceed the max &#39;</span>
                <span class="s1">&#39;sequence length.&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duck_prompt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># The actual LLM call.</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="o">**</span><span class="n">prompt_kwargs</span><span class="p">,</span> <span class="n">key_</span><span class="o">=</span><span class="n">prompt_key</span><span class="p">)</span>

        <span class="n">answer</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">answer</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;Sorry, I don</span><span class="se">\&#39;</span><span class="s1">t know. Can you try &#39;</span> \
                     <span class="s1">&#39;rephrasing your question?&#39;</span>
            <span class="c1"># This is intentionally nested in if statement because if answer is</span>
            <span class="c1"># truthy, we will have already printed it via our callback if not</span>
            <span class="c1"># in silent mode.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>

        <span class="n">parsed_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_func</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
        <span class="c1"># When using the `duck` jupyter magic in &quot;insert&quot; mode, we reference</span>
        <span class="c1"># the CodeCompletionCache to populate the new code cell.</span>
        <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_completion</span> <span class="o">=</span> <span class="n">answer</span>
        <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_explanation</span> <span class="o">=</span> <span class="n">parsed_kwargs</span><span class="p">[</span><span class="s1">&#39;explanation&#39;</span><span class="p">]</span>
        <span class="c1"># TODO: maybe check if code or full_code is more appropriate to store</span>
        <span class="c1"># as last_code, either depending on self.full_context or by doing a</span>
        <span class="c1"># quick str similarity to each.</span>
        <span class="c1"># Contextless prompt has no `code` key.</span>
        <span class="n">old_code</span> <span class="o">=</span> <span class="n">prompt_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">new_code</span> <span class="o">=</span> <span class="n">parsed_kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
        <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_code_diff</span> <span class="o">=</span> <span class="n">colordiff_new_str</span><span class="p">(</span><span class="n">old_code</span><span class="p">,</span>
                                                               <span class="n">new_code</span><span class="p">)</span>
        <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_code</span> <span class="o">=</span> <span class="n">old_code</span>
        <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_new_code</span> <span class="o">=</span> <span class="n">new_code</span>
        <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_extra</span> <span class="o">=</span> <span class="n">parsed_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extra&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_kwargs_hash</span> <span class="o">=</span> <span class="n">kwargs_hash</span>

    <span class="k">def</span> <span class="nf">precmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;We need to define this to make our errors module work. Our</span>
<span class="sd">        post_mortem function sometimes places a tuple in our debugger&#39;s</span>
<span class="sd">        cmdqueue and precmd is called as part of the default cmdloop method.</span>
<span class="sd">        Technically it calls postcmd too but we don&#39;t need to override that</span>
<span class="sd">        because it does nothing with its line argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">line</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">line</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">precmd</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">trace</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">precmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_stack_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_lineno</span><span class="p">,</span> <span class="n">prompt_prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-&gt; &#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is called automatically when entering a debugger session</span>
<span class="sd">        and it prints a message to stdout like</span>

<span class="sd">        ```</span>
<span class="sd">        &gt; &lt;ipython-input-20-9c67d40d0f93&gt;(2)&lt;module&gt;()</span>
<span class="sd">        -&gt; print + 6</span>
<span class="sd">        ```</span>

<span class="sd">        In silent mode (like when using the roboduck logger with stdout=False),</span>
<span class="sd">        we want to disable that message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">frame</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">frame_lineno</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">curframe</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&gt; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">format_stack_entry</span><span class="p">(</span><span class="n">frame_lineno</span><span class="p">,</span> <span class="n">prompt_prefix</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="lib.roboduck.debug.DuckDB.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">prompt_name</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">max_len_per_var</span><span class="o">=</span><span class="mi">79</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdb_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_func</span><span class="o">=</span><span class="n">parse_completion</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">chat_kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <h5 id="lib.roboduck.debug.DuckDB.__init__--parameters">Parameters</h5>

<details class="prompt_name">
  <summary>str</summary>
  <p>Name of prompt template to use when querying chatGPT. Roboduck
currently provides several builtin options
(see roboduck.prompts.chat):
    debug - for interactive debugging sessions on the relevant
        snippet of code.
    debug_full - for interactive debugging sessions on the whole
        notebook (no difference from "debug" for scripts). Risks
        creating a context that is too long.
    debug_stack_trace - for automatic error explanations or
        logging.
Alternatively, can also define your own template in a yaml file
mimicking the format of the builtin templates and pass in the
path to that file as a string.</p>
</details>
<details class="max_len_per_var">
  <summary>int</summary>
  <p>Limits number of characters per variable when communicating
current state (local or global depending on <code>full_context</code>) to
gpt. If unbounded, that section of the prompt alone could grow
very big . I somewhat arbitrarily set 79 as the default, i.e.
1 line of python per variable. I figure that's usually enough to
communicate the gist of what's happening.</p>
</details>
<details class="silent">
  <summary>bool</summary>
  <p>If True, print gpt completions to stdout. One example of when False
is appropriate is our logging module - we want to get the
explanation and update the exception message which then gets
logged, but we don't care about typing results in real time.</p>
</details>
<details class="pdb_kwargs">
  <summary>dict or None</summary>
  <p>Additional kwargs for base Pdb class.</p>
</details>
<details class="parse_func">
  <summary>function</summary>
  <p>This will be called on the generated text each time gpt provides a
completion. It returns a dictionary whose values will be stored
in CodeCompletionCache in this module. See the default function's
docstring for guidance on writing a custom function.</p>
</details>
<details class="color">
  <summary>str</summary>
  <p>Color to print gpt completions in. Sometimes we want to change this
to red, such as in the errors module, to make it clearer that an
error occurred.</p>
</details>
<details class="chat_kwargs">
  <summary>any</summary>
  <p>Additional kwargs to configure our Chat class (passed to
its <code>from_config</code> factory). Common example would be setting
<code>chat_class=roboduck.langchain.chat.DummyChatModel</code>
which mocks api calls (good for development, saves money).</p>
</details>
      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt_name</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">max_len_per_var</span><span class="o">=</span><span class="mi">79</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">pdb_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_func</span><span class="o">=</span><span class="n">parse_completion</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">chat_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prompt_name: str</span>
<span class="sd">        Name of prompt template to use when querying chatGPT. Roboduck</span>
<span class="sd">        currently provides several builtin options</span>
<span class="sd">        (see roboduck.prompts.chat):</span>
<span class="sd">            debug - for interactive debugging sessions on the relevant</span>
<span class="sd">                snippet of code.</span>
<span class="sd">            debug_full - for interactive debugging sessions on the whole</span>
<span class="sd">                notebook (no difference from &quot;debug&quot; for scripts). Risks</span>
<span class="sd">                creating a context that is too long.</span>
<span class="sd">            debug_stack_trace - for automatic error explanations or</span>
<span class="sd">                logging.</span>
<span class="sd">        Alternatively, can also define your own template in a yaml file</span>
<span class="sd">        mimicking the format of the builtin templates and pass in the</span>
<span class="sd">        path to that file as a string.</span>
<span class="sd">    max_len_per_var: int</span>
<span class="sd">        Limits number of characters per variable when communicating</span>
<span class="sd">        current state (local or global depending on `full_context`) to</span>
<span class="sd">        gpt. If unbounded, that section of the prompt alone could grow</span>
<span class="sd">        very big . I somewhat arbitrarily set 79 as the default, i.e.</span>
<span class="sd">        1 line of python per variable. I figure that&#39;s usually enough to</span>
<span class="sd">        communicate the gist of what&#39;s happening.</span>
<span class="sd">    silent: bool</span>
<span class="sd">        If True, print gpt completions to stdout. One example of when False</span>
<span class="sd">        is appropriate is our logging module - we want to get the</span>
<span class="sd">        explanation and update the exception message which then gets</span>
<span class="sd">        logged, but we don&#39;t care about typing results in real time.</span>
<span class="sd">    pdb_kwargs: dict or None</span>
<span class="sd">        Additional kwargs for base Pdb class.</span>
<span class="sd">    parse_func: function</span>
<span class="sd">        This will be called on the generated text each time gpt provides a</span>
<span class="sd">        completion. It returns a dictionary whose values will be stored</span>
<span class="sd">        in CodeCompletionCache in this module. See the default function&#39;s</span>
<span class="sd">        docstring for guidance on writing a custom function.</span>
<span class="sd">    color: str</span>
<span class="sd">        Color to print gpt completions in. Sometimes we want to change this</span>
<span class="sd">        to red, such as in the errors module, to make it clearer that an</span>
<span class="sd">        error occurred.</span>
<span class="sd">    chat_kwargs: any</span>
<span class="sd">        Additional kwargs to configure our Chat class (passed to</span>
<span class="sd">        its `from_config` factory). Common example would be setting</span>
<span class="sd">        `chat_class=roboduck.langchain.chat.DummyChatModel`</span>
<span class="sd">        which mocks api calls (good for development, saves money).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">pdb_kwargs</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;&gt;&gt;&gt; &#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">duck_prompt</span> <span class="o">=</span> <span class="s1">&#39;[Duck] &#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_name</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;streaming&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;streaming&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">chat_kwargs</span><span class="p">[</span><span class="s1">&#39;callback_manager&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CallbackManager</span><span class="p">(</span>
            <span class="p">[</span><span class="n">LiveTypingCallbackHandler</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="c1"># Dev color is what we print the prompt in when user asks a question</span>
    <span class="c1"># in dev mode.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dev_color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;red&#39;</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
    <span class="c1"># Must create self.chat before setting _chat_prompt_keys,</span>
    <span class="c1"># and full_context after both of those.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">chat</span> <span class="o">=</span> <span class="n">Chat</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="o">**</span><span class="n">chat_kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_user_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_user_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_prompt_keys</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_context</span> <span class="o">=</span> <span class="s1">&#39;full_code&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prompt_name</span> <span class="o">=</span> <span class="n">prompt_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repr_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">truncated_repr</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="n">max_len_per_var</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parse_func</span> <span class="o">=</span> <span class="n">parse_func</span>
    <span class="c1"># This gets updated every time the user asks a question.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prev_kwargs_hash</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lib.roboduck.debug.DuckDB.ask_language_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ask_language_model</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">stack_trace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>When the user asks a question during a debugging session, query
gpt for the answer and type it back to them live.</p>
<h5 id="lib.roboduck.debug.DuckDB.ask_language_model--parameters">Parameters</h5>

<details class="question">
  <summary>str</summary>
  <p>User question, e.g. "Why are the first three values in nums equal
to 5 when the input list only had a single 5?". (Example is from
a faulty bubble sort implementation.)</p>
</details>
<details class="stack_trace">
  <summary>str</summary>
  <p>When using the "debug_stack_trace" prompt, we need to pass a
stack trace string into the prompt.</p>
</details>
<details class="verbose">
  <summary>bool</summary>
  <p>If True, print the full gpt prompt in red before making the api
call. User activates this mode by prefixing their question with
'[dev]'. This overrides self.silent.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ask_language_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">stack_trace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;When the user asks a question during a debugging session, query</span>
<span class="sd">    gpt for the answer and type it back to them live.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    question: str</span>
<span class="sd">        User question, e.g. &quot;Why are the first three values in nums equal</span>
<span class="sd">        to 5 when the input list only had a single 5?&quot;. (Example is from</span>
<span class="sd">        a faulty bubble sort implementation.)</span>
<span class="sd">    stack_trace: str</span>
<span class="sd">        When using the &quot;debug_stack_trace&quot; prompt, we need to pass a</span>
<span class="sd">        stack trace string into the prompt.</span>
<span class="sd">    verbose: bool</span>
<span class="sd">        If True, print the full gpt prompt in red before making the api</span>
<span class="sd">        call. User activates this mode by prefixing their question with</span>
<span class="sd">        &#39;[dev]&#39;. This overrides self.silent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Don&#39;t provide long context-laden prompt if nothing has changed since</span>
    <span class="c1"># the user&#39;s last question. This is often a followup/clarifying</span>
    <span class="c1"># question.</span>
    <span class="n">prompt_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_prompt_kwargs</span><span class="p">()</span>
    <span class="n">kwargs_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwargs_hash</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_kwargs_hash</span><span class="p">:</span>
        <span class="n">prompt_kwargs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">prompt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_user_key</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prompt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_user_key</span>

    <span class="c1"># Perform surgery on kwargs depending on what fields are expected.</span>
    <span class="n">field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">(</span><span class="n">prompt_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;question&#39;</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
        <span class="n">prompt_kwargs</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">question</span>
    <span class="k">if</span> <span class="n">stack_trace</span><span class="p">:</span>
        <span class="n">prompt_kwargs</span><span class="p">[</span><span class="s1">&#39;stack_trace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stack_trace</span>

    <span class="c1"># Validate that expected fields are present and provide interpretable</span>
    <span class="c1"># error message if not.</span>
    <span class="n">kwargs_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="p">)</span>
    <span class="n">only_in_kwargs</span> <span class="o">=</span> <span class="n">kwargs_names</span> <span class="o">-</span> <span class="n">field_names</span>
    <span class="n">only_in_expected</span> <span class="o">=</span> <span class="n">field_names</span> <span class="o">-</span> <span class="n">kwargs_names</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;If you are using a custom prompt, you may need to &#39;</span> \
                <span class="s1">&#39;subclass roboduck.debug.DuckDB and override the &#39;</span> \
                <span class="s1">&#39;_get_prompt_kwargs method.&#39;</span>
    <span class="k">if</span> <span class="n">only_in_kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Received unexpected kwarg(s): </span><span class="si">{</span><span class="n">only_in_kwargs</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s1"> &#39;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">only_in_expected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Missing required kwarg(s): </span><span class="si">{</span><span class="n">only_in_expected</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">user_message</span><span class="p">(</span><span class="n">key_</span><span class="o">=</span><span class="n">prompt_key</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">prompt_kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1_000</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s1">&#39;Prompt is very long (&gt;1k words). You</span><span class="se">\&#39;</span><span class="s1">re approaching a risky&#39;</span>
            <span class="s1">&#39; zone where your prompt + completion might exceed the max &#39;</span>
            <span class="s1">&#39;sequence length.&#39;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duck_prompt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># The actual LLM call.</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="o">**</span><span class="n">prompt_kwargs</span><span class="p">,</span> <span class="n">key_</span><span class="o">=</span><span class="n">prompt_key</span><span class="p">)</span>

    <span class="n">answer</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">answer</span><span class="p">:</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;Sorry, I don</span><span class="se">\&#39;</span><span class="s1">t know. Can you try &#39;</span> \
                 <span class="s1">&#39;rephrasing your question?&#39;</span>
        <span class="c1"># This is intentionally nested in if statement because if answer is</span>
        <span class="c1"># truthy, we will have already printed it via our callback if not</span>
        <span class="c1"># in silent mode.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>

    <span class="n">parsed_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_func</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="c1"># When using the `duck` jupyter magic in &quot;insert&quot; mode, we reference</span>
    <span class="c1"># the CodeCompletionCache to populate the new code cell.</span>
    <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_completion</span> <span class="o">=</span> <span class="n">answer</span>
    <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_explanation</span> <span class="o">=</span> <span class="n">parsed_kwargs</span><span class="p">[</span><span class="s1">&#39;explanation&#39;</span><span class="p">]</span>
    <span class="c1"># TODO: maybe check if code or full_code is more appropriate to store</span>
    <span class="c1"># as last_code, either depending on self.full_context or by doing a</span>
    <span class="c1"># quick str similarity to each.</span>
    <span class="c1"># Contextless prompt has no `code` key.</span>
    <span class="n">old_code</span> <span class="o">=</span> <span class="n">prompt_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">new_code</span> <span class="o">=</span> <span class="n">parsed_kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
    <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_code_diff</span> <span class="o">=</span> <span class="n">colordiff_new_str</span><span class="p">(</span><span class="n">old_code</span><span class="p">,</span>
                                                           <span class="n">new_code</span><span class="p">)</span>
    <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_code</span> <span class="o">=</span> <span class="n">old_code</span>
    <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_new_code</span> <span class="o">=</span> <span class="n">new_code</span>
    <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">last_extra</span> <span class="o">=</span> <span class="n">parsed_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extra&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prev_kwargs_hash</span> <span class="o">=</span> <span class="n">kwargs_hash</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lib.roboduck.debug.DuckDB.field_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">field_names</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get names of variables that are expected to be passed into default
user prompt template.</p>
<h5 id="lib.roboduck.debug.DuckDB.field_names--returns">Returns</h5>
<p>set[str]</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get names of variables that are expected to be passed into default</span>
<span class="sd">    user prompt template.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    set[str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">input_variables</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lib.roboduck.debug.DuckDB.onecmd" class="doc doc-heading">
<code class="highlight language-python"><span class="n">onecmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Base class describes this as follows:</p>
<p>Interpret the argument as though it had been typed in response to the
prompt. Checks whether this line is typed at the normal prompt or in
a breakpoint command list definition.</p>
<p>We add an extra check in the if block to check if the user asked a
question. If so, we ask gpt. If not, we treat it as a regular pdb
command.</p>
<h5 id="lib.roboduck.debug.DuckDB.onecmd--parameters">Parameters</h5>

<details class="line">
  <summary>str or tuple</summary>
  <p>If str, this is a regular line like in the standard debugger.
If tuple, this contains (line str, stack trace str - see
roboduck.errors.post_mortem for the actual insertion into the
cmdqueue). This is for use with the debug_stack_trace mode.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">onecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class describes this as follows:</span>

<span class="sd">    Interpret the argument as though it had been typed in response to the</span>
<span class="sd">    prompt. Checks whether this line is typed at the normal prompt or in</span>
<span class="sd">    a breakpoint command list definition.</span>

<span class="sd">    We add an extra check in the if block to check if the user asked a</span>
<span class="sd">    question. If so, we ask gpt. If not, we treat it as a regular pdb</span>
<span class="sd">    command.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    line: str or tuple</span>
<span class="sd">        If str, this is a regular line like in the standard debugger.</span>
<span class="sd">        If tuple, this contains (line str, stack trace str - see</span>
<span class="sd">        roboduck.errors.post_mortem for the actual insertion into the</span>
<span class="sd">        cmdqueue). This is for use with the debug_stack_trace mode.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">stack_trace</span> <span class="o">=</span> <span class="n">line</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stack_trace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands_defining</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_language_model</span><span class="p">(</span>
                <span class="n">line</span><span class="p">,</span>
                <span class="n">stack_trace</span><span class="o">=</span><span class="n">stack_trace</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[dev]&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Cmd</span><span class="o">.</span><span class="n">onecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_command_def</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lib.roboduck.debug.DuckDB.precmd" class="doc doc-heading">
<code class="highlight language-python"><span class="n">precmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>We need to define this to make our errors module work. Our
post_mortem function sometimes places a tuple in our debugger's
cmdqueue and precmd is called as part of the default cmdloop method.
Technically it calls postcmd too but we don't need to override that
because it does nothing with its line argument.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;We need to define this to make our errors module work. Our</span>
<span class="sd">    post_mortem function sometimes places a tuple in our debugger&#39;s</span>
<span class="sd">    cmdqueue and precmd is called as part of the default cmdloop method.</span>
<span class="sd">    Technically it calls postcmd too but we don&#39;t need to override that</span>
<span class="sd">    because it does nothing with its line argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">precmd</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">trace</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">precmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lib.roboduck.debug.DuckDB.print_stack_entry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">print_stack_entry</span><span class="p">(</span><span class="n">frame_lineno</span><span class="p">,</span> <span class="n">prompt_prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-&gt; &#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This is called automatically when entering a debugger session
and it prints a message to stdout like</p>
<div class="highlight"><pre><span></span><code>&gt; &lt;ipython-input-20-9c67d40d0f93&gt;(2)&lt;module&gt;()
-&gt; print + 6
</code></pre></div>
<p>In silent mode (like when using the roboduck logger with stdout=False),
we want to disable that message.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">print_stack_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_lineno</span><span class="p">,</span> <span class="n">prompt_prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-&gt; &#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is called automatically when entering a debugger session</span>
<span class="sd">    and it prints a message to stdout like</span>

<span class="sd">    ```</span>
<span class="sd">    &gt; &lt;ipython-input-20-9c67d40d0f93&gt;(2)&lt;module&gt;()</span>
<span class="sd">    -&gt; print + 6</span>
<span class="sd">    ```</span>

<span class="sd">    In silent mode (like when using the roboduck logger with stdout=False),</span>
<span class="sd">    we want to disable that message.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">frame</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">frame_lineno</span>
    <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">curframe</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&gt; &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">format_stack_entry</span><span class="p">(</span><span class="n">frame_lineno</span><span class="p">,</span> <span class="n">prompt_prefix</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="lib.roboduck.debug.duck" class="doc doc-heading">
<code class="highlight language-python"><span class="n">duck</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Roboduck equivalent of native python breakpoint().
The DuckDB docstring is below. Any kwargs passed in to this function
will be passed to its constructor.</p>

      <details class="quote">
        <summary>Source code in <code>lib/roboduck/debug.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_docstring</span><span class="p">(</span><span class="n">DuckDB</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">duck</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Roboduck equivalent of native python breakpoint().</span>
<span class="sd">    The DuckDB docstring is below. Any kwargs passed in to this function</span>
<span class="sd">    will be passed to its constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DuckDB</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">set_trace</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51198bba.min.js"></script>
      
    
  </body>
</html>