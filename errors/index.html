
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../debug/">
      
      
        <link rel="next" href="../logging/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Errors - RoboDuck</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lib.roboduck.errors" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RoboDuck" class="md-header__button md-logo" aria-label="RoboDuck" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RoboDuck
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Errors
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RoboDuck" class="md-nav__button md-logo" aria-label="RoboDuck" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    RoboDuck
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Errors
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Errors
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.errors" class="md-nav__link">
    <span class="md-ellipsis">
      errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.errors-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.default_excepthook" class="md-nav__link">
    <span class="md-ellipsis">
      default_excepthook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.ipy" class="md-nav__link">
    <span class="md-ellipsis">
      ipy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.errors-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.post_mortem" class="md-nav__link">
    <span class="md-ellipsis">
      post_mortem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.print_exception" class="md-nav__link">
    <span class="md-ellipsis">
      print_exception
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.excepthook" class="md-nav__link">
    <span class="md-ellipsis">
      excepthook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.enable" class="md-nav__link">
    <span class="md-ellipsis">
      enable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.disable" class="md-nav__link">
    <span class="md-ellipsis">
      disable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.stack_trace" class="md-nav__link">
    <span class="md-ellipsis">
      stack_trace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../magic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Magic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ipy_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IPython utils
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decorators
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_prompts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Prompts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.errors" class="md-nav__link">
    <span class="md-ellipsis">
      errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.errors-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.default_excepthook" class="md-nav__link">
    <span class="md-ellipsis">
      default_excepthook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.ipy" class="md-nav__link">
    <span class="md-ellipsis">
      ipy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.roboduck.errors-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.post_mortem" class="md-nav__link">
    <span class="md-ellipsis">
      post_mortem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.print_exception" class="md-nav__link">
    <span class="md-ellipsis">
      print_exception
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.excepthook" class="md-nav__link">
    <span class="md-ellipsis">
      excepthook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.enable" class="md-nav__link">
    <span class="md-ellipsis">
      enable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.disable" class="md-nav__link">
    <span class="md-ellipsis">
      disable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.roboduck.errors.stack_trace" class="md-nav__link">
    <span class="md-ellipsis">
      stack_trace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Errors</h1>

<div class="doc doc-object doc-module">



<a id="lib.roboduck.errors"></a>
    <div class="doc doc-contents first">

        <p>Errors that explain themselves! Or more precisely, errors that are explained
to you by a gpt-esque model. Simply importing this module will change python's
default behavior when it encounters an error.</p>


<details class="quickstart" open>
  <summary>Quickstart</summary>
  <p>Importing the errors module automatically enables optional error explanations.
<code>disable()</code> reverts to python's regular behavior on errors. <code>enable()</code> can be
used to re-enable error explanations or to change settings. For example,
setting auto=True automatically explains all errors rather than asking the user
if they want an explanation (y/n) when an error occurs.</p>
<pre><code>from roboduck import errors

data = {'x': 0}
y = data.x

errors.disable()
y = data.x

errors.enable(auto=True)
y = data.x
</code></pre>
</details>


  <div class="doc doc-children">





<h2 id="lib.roboduck.errors-attributes">Attributes</h2>

<div class="doc doc-object doc-attribute">



<h3 id="lib.roboduck.errors.default_excepthook" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default_excepthook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lib.roboduck.errors.ipy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ipy</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<h2 id="lib.roboduck.errors-functions">Functions</h2>

<div class="doc doc-object doc-function">


<h3 id="lib.roboduck.errors.post_mortem" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">post_mortem</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Pdb</span><span class="o">=</span><span class="n">DuckDB</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">prompt_name</span><span class="o">=</span><span class="s1">&#39;debug_stack_trace&#39;</span><span class="p">,</span> <span class="n">colordiff</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Drop-in replacement (hence the slightly odd arg order, where trace is
required but third positionally) for pdb.post_mortem that allows us to get
both the stack trace AND global/local vars from the program state right
before an exception occurred.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>t</code></td>
            <td>
                  <code>traceback</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error traceback if one is available. Single character name is a
holdover from the default post_mortem.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Pdb</code></td>
            <td>
                  <code>type</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Debugger class. Name is capitalized to provide consistent interface
with default post_mortem function.</p>
              </div>
            </td>
            <td>
                  <code><span title="roboduck.debug.DuckDB">DuckDB</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trace</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stack trace formatted as a single string. Required - default value
just helps us maintain a consistent interface with pdb.post_mortem.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>prompt_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prompt name that will be passed to our debugger class. Usually
should leave this as the default. We expect the name to contain
'debug' and will warn if it doesn't.</p>
              </div>
            </td>
            <td>
                  <code>&#39;debug_stack_trace&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>colordiff</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the new code snippet in the exception will print new
parts in green.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>interactive</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False, LLM will just explain the error and exit. If True, user
instead will be thrown into an interactive debugging session where
they can ask followup questions (the first LLM response will still be
automatic though).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>kwargs</code></td>
            <td>
                  <code>any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional kwargs to pass to debugger class constructor. The docstring
of the default class is included below for reference.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lib/roboduck/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_docstring</span><span class="p">(</span><span class="n">DuckDB</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post_mortem</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">Pdb</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">DuckDB</span><span class="p">,</span>
    <span class="n">trace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">prompt_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;debug_stack_trace&#39;</span><span class="p">,</span>
    <span class="n">colordiff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop-in replacement (hence the slightly odd arg order, where trace is</span>
<span class="sd">    required but third positionally) for pdb.post_mortem that allows us to get</span>
<span class="sd">    both the stack trace AND global/local vars from the program state right</span>
<span class="sd">    before an exception occurred.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : traceback</span>
<span class="sd">        Error traceback if one is available. Single character name is a</span>
<span class="sd">        holdover from the default post_mortem.</span>
<span class="sd">    Pdb : type</span>
<span class="sd">        Debugger class. Name is capitalized to provide consistent interface</span>
<span class="sd">        with default post_mortem function.</span>
<span class="sd">    trace : str</span>
<span class="sd">        Stack trace formatted as a single string. Required - default value</span>
<span class="sd">        just helps us maintain a consistent interface with pdb.post_mortem.</span>
<span class="sd">    prompt_name : str</span>
<span class="sd">        The prompt name that will be passed to our debugger class. Usually</span>
<span class="sd">        should leave this as the default. We expect the name to contain</span>
<span class="sd">        &#39;debug&#39; and will warn if it doesn&#39;t.</span>
<span class="sd">    colordiff : bool</span>
<span class="sd">        If True, the new code snippet in the exception will print new</span>
<span class="sd">        parts in green.</span>
<span class="sd">    interactive : bool</span>
<span class="sd">        If False, LLM will just explain the error and exit. If True, user</span>
<span class="sd">        instead will be thrown into an interactive debugging session where</span>
<span class="sd">        they can ask followup questions (the first LLM response will still be</span>
<span class="sd">        automatic though).</span>
<span class="sd">    kwargs : any</span>
<span class="sd">        Additional kwargs to pass to debugger class constructor. The docstring</span>
<span class="sd">        of the default class is included below for reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;post_mortem outside of exception context&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;debug&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prompt_name</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;You passed an unexpected prompt_name (</span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s1">) to &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;post_mortem. Are you sure you didn</span><span class="se">\&#39;</span><span class="s1">t mean to use &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;debug_stack_trace?&#39;</span>
        <span class="p">)</span>
    <span class="k">assert</span> <span class="n">trace</span><span class="p">,</span> <span class="s1">&#39;Trace passed to post_mortem should be truthy.&#39;</span>

    <span class="c1"># This serves almost like a soft assert statement - if user defines some</span>
    <span class="c1"># custom debugger class and the question leaks through, gpt should</span>
    <span class="c1"># hopefully warn us.</span>
    <span class="n">dummy_question</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;This is a fake question to ensure that our ask_language_model &#39;</span>
        <span class="s1">&#39;method gets called. Our debugger class should remove this from the &#39;</span>
        <span class="s1">&#39;prompt kwargs before calling gpt. If you can read this, can you &#39;</span>
        <span class="s1">&#39;indicate that in your response?&#39;</span>
    <span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pdb</span><span class="p">(</span><span class="n">prompt_name</span><span class="o">=</span><span class="n">prompt_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">cmdqueue</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">dummy_question</span><span class="p">,</span> <span class="n">trace</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;When done, enter `q` to quit.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">cmdqueue</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">interaction</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="c1"># Make gpt explanation available as part of last error message,</span>
    <span class="c1"># accessible via sys.last_value.</span>
    <span class="n">last_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;last_value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">last_completion</span> <span class="o">=</span> <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_completion&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">last_completion</span> <span class="ow">and</span> <span class="n">last_value</span><span class="p">:</span>
        <span class="c1"># Logging often eschews code-diffing because it doesn&#39;t render in file.</span>
        <span class="n">last_code</span> <span class="o">=</span> <span class="n">CodeCompletionCache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;last_code_diff&#39;</span> <span class="k">if</span> <span class="n">colordiff</span> <span class="k">else</span> <span class="s1">&#39;last_new_code&#39;</span>
        <span class="p">)</span>
        <span class="n">last_value</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">arg</span> <span class="k">if</span> <span class="n">i</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">last_completion</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">last_code</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">last_value</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="lib.roboduck.errors.print_exception" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_exception</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Replacement for traceback.print_exception() that returns the
whole stack trace as a single string. Used in roboduck's custom excepthook
to allow us to show the stack trace to gpt. The original function's
docstring is below:</p>
<p>Print exception up to 'limit' stack trace entries from 'tb' to 'file'.</p>
<p>This differs from print_tb() in the following ways: (1) if
traceback is not None, it prints a header "Traceback (most recent
call last):"; (2) it prints the exception type and value after the
stack trace; (3) if type is SyntaxError and value has the
appropriate format, it prints the line where the syntax error
occurred with a caret on the next line indicating the approximate
position of the error.</p>

            <details class="quote">
              <summary>Source code in <code>lib/roboduck/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">print_exception</span><span class="p">(</span><span class="n">etype</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="n">TracebackType</span><span class="p">,</span>
                    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">chain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replacement for traceback.print_exception() that returns the</span>
<span class="sd">    whole stack trace as a single string. Used in roboduck&#39;s custom excepthook</span>
<span class="sd">    to allow us to show the stack trace to gpt. The original function&#39;s</span>
<span class="sd">    docstring is below:</span>

<span class="sd">    Print exception up to &#39;limit&#39; stack trace entries from &#39;tb&#39; to &#39;file&#39;.</span>

<span class="sd">    This differs from print_tb() in the following ways: (1) if</span>
<span class="sd">    traceback is not None, it prints a header &quot;Traceback (most recent</span>
<span class="sd">    call last):&quot;; (2) it prints the exception type and value after the</span>
<span class="sd">    stack trace; (3) if type is SyntaxError and value has the</span>
<span class="sd">    appropriate format, it prints the line where the syntax error</span>
<span class="sd">    occurred with a caret on the next line indicating the approximate</span>
<span class="sd">    position of the error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># format_exception has ignored etype for some time, and code such as cgitb</span>
    <span class="c1"># passes in bogus values as a result. For compatibility with such code we</span>
    <span class="c1"># ignore it here (rather than in the new TracebackException API).</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">TracebackException</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trace</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="lib.roboduck.errors.excepthook" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">excepthook</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">prompt_name</span><span class="o">=</span><span class="s1">&#39;debug_stack_trace&#39;</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DuckDB</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Replaces sys.excepthook when module is imported. When an error is
thrown, the user is asked whether they want an explanation of what went
wrong. If they enter 'y' or 'yes', it will query gpt for help. Unlike
roboduck.debug.duck(), the user does not need to manually type a
question. By default we don't linger in the debugger - we just provide an
explanation and exit. Passing in interactive=True allows the user to ask
followup questions.</p>
<p>Disable by calling roboduck.errors.disable().</p>
<p>Parameters are the same as the default sys.excepthook function. Kwargs
are forwarded to our custom post_mortem function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>etype</code></td>
            <td>
                  <code>type</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The class of exception that just occurred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>val</code></td>
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The error that just occurred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tb</code></td>
            <td>
                  <code>traceback</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The traceback from the error that just occurred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>prompt_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The roboduck prompt to use (can be a builtin option in
roboduck.prompts.chat or a path to a user-defined yaml file).</p>
              </div>
            </td>
            <td>
                  <code>&#39;debug_stack_trace&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>auto</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, automatically start explaining every error that occurs
(usually not recommended). If False, user will be asked to type y/n
before asking an LLM.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cls</code></td>
            <td>
                  <code>type</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The debugger class to use. By default it's the roboduck equivalent of
pdb.Pdb, but you could also subclass DuckDB and do something custom.</p>
              </div>
            </td>
            <td>
                  <code><span title="roboduck.debug.DuckDB">DuckDB</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>kwargs</code></td>
            <td>
                  <code>any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional kwargs to pass to the debugger cls,
e.g. "model_name='gpt-4'".</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lib/roboduck/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">excepthook</span><span class="p">(</span><span class="n">etype</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="n">TracebackType</span><span class="p">,</span>
               <span class="n">prompt_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;debug_stack_trace&#39;</span><span class="p">,</span>
               <span class="n">auto</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">DuckDB</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replaces sys.excepthook when module is imported. When an error is</span>
<span class="sd">    thrown, the user is asked whether they want an explanation of what went</span>
<span class="sd">    wrong. If they enter &#39;y&#39; or &#39;yes&#39;, it will query gpt for help. Unlike</span>
<span class="sd">    roboduck.debug.duck(), the user does not need to manually type a</span>
<span class="sd">    question. By default we don&#39;t linger in the debugger - we just provide an</span>
<span class="sd">    explanation and exit. Passing in interactive=True allows the user to ask</span>
<span class="sd">    followup questions.</span>

<span class="sd">    Disable by calling roboduck.errors.disable().</span>

<span class="sd">    Parameters are the same as the default sys.excepthook function. Kwargs</span>
<span class="sd">    are forwarded to our custom post_mortem function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    etype : type</span>
<span class="sd">        The class of exception that just occurred.</span>
<span class="sd">    val : Exception</span>
<span class="sd">        The error that just occurred.</span>
<span class="sd">    tb : traceback</span>
<span class="sd">        The traceback from the error that just occurred.</span>
<span class="sd">    prompt_name : str</span>
<span class="sd">        The roboduck prompt to use (can be a builtin option in</span>
<span class="sd">        roboduck.prompts.chat or a path to a user-defined yaml file).</span>
<span class="sd">    auto : bool</span>
<span class="sd">        If True, automatically start explaining every error that occurs</span>
<span class="sd">        (usually not recommended). If False, user will be asked to type y/n</span>
<span class="sd">        before asking an LLM.</span>
<span class="sd">    cls : type</span>
<span class="sd">        The debugger class to use. By default it&#39;s the roboduck equivalent of</span>
<span class="sd">        pdb.Pdb, but you could also subclass DuckDB and do something custom.</span>
<span class="sd">    kwargs : any</span>
<span class="sd">        Additional kwargs to pass to the debugger cls,</span>
<span class="sd">        e.g. &quot;model_name=&#39;gpt-4&#39;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">last_type</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">last_value</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">last_traceback</span> <span class="o">=</span> <span class="n">etype</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">print_exception</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;silent&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt_name</span><span class="o">=</span><span class="n">prompt_name</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tb</span><span class="p">,</span> <span class="n">Pdb</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">post_mortem</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Explain error message? [y/n]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">post_mortem</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized command. Valid choices are &quot;y&quot; or &quot;n&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="lib.roboduck.errors.enable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enable</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Enable conversational debugging mode. This is called automatically on
module import. However, users may wish to make changes, e.g. set auto=True
or pass in a custom debugger cls, and this function makes that possible.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>kwargs</code></td>
            <td>
                  <code>any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>These are passed to our custom debugger class. Some common args are
below:</p>
<p>auto (bool) - if True, automatically have an LLM explain every error
    that occurs without asking the user for confirmation. This is used
    in our logging module, for instance. You almost
    certainly want to keep this as False (the default) for any
    interactive development.
interactive (bool) - if True, error explanations will leave the user in
    an interactive session where they can ask followup questions. If
    False (the default), we will simply explain the error and exit the
    session (more similar to standard python error handling).
cls (type) - the debugger class to use.
prompt_name (str) - determines what prompt/prompt_name the custom
    debugger uses, e.g. "debug_stack_trace". Users can also define
    their own custom prompt
    (https://hdmamin.github.io/roboduck/custom_prompts/)
    and pass in the file path here.
colordiff (bool) - if True, new code snippet will print new parts
    in green.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lib/roboduck/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enable conversational debugging mode. This is called automatically on</span>
<span class="sd">    module import. However, users may wish to make changes, e.g. set auto=True</span>
<span class="sd">    or pass in a custom debugger cls, and this function makes that possible.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kwargs : any</span>
<span class="sd">        These are passed to our custom debugger class. Some common args are</span>
<span class="sd">        below:</span>

<span class="sd">        auto (bool) - if True, automatically have an LLM explain every error</span>
<span class="sd">            that occurs without asking the user for confirmation. This is used</span>
<span class="sd">            in our logging module, for instance. You almost</span>
<span class="sd">            certainly want to keep this as False (the default) for any</span>
<span class="sd">            interactive development.</span>
<span class="sd">        interactive (bool) - if True, error explanations will leave the user in</span>
<span class="sd">            an interactive session where they can ask followup questions. If</span>
<span class="sd">            False (the default), we will simply explain the error and exit the</span>
<span class="sd">            session (more similar to standard python error handling).</span>
<span class="sd">        cls (type) - the debugger class to use.</span>
<span class="sd">        prompt_name (str) - determines what prompt/prompt_name the custom</span>
<span class="sd">            debugger uses, e.g. &quot;debug_stack_trace&quot;. Users can also define</span>
<span class="sd">            their own custom prompt</span>
<span class="sd">            (https://hdmamin.github.io/roboduck/custom_prompts/)</span>
<span class="sd">            and pass in the file path here.</span>
<span class="sd">        colordiff (bool) - if True, new code snippet will print new parts</span>
<span class="sd">            in green.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hook</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">excepthook</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ipy_excepthook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">evalue</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">tb_offset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;IPython doesn&#39;t use sys.excepthook. We have to handle this case</span>
<span class="sd">        separately and make sure it expects the right argument names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">hook</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">evalue</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>

    <span class="c1"># Overwrite default error handling.</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">hook</span>

    <span class="c1"># Only necessary/possible when in ipython.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ipy</span><span class="o">.</span><span class="n">set_custom_exc</span><span class="p">((</span><span class="ne">Exception</span><span class="p">,),</span> <span class="n">ipy_excepthook</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="lib.roboduck.errors.disable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disable</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Revert to default behavior when exceptions are thrown.</p>

            <details class="quote">
              <summary>Source code in <code>lib/roboduck/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">disable</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Revert to default behavior when exceptions are thrown.&quot;&quot;&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">default_excepthook</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Tried doing `ipy.set_custom_exc((Exception,), None)` as suggested by</span>
        <span class="c1"># stackoverflow and chatgpt but it didn&#39;t quite restore the default</span>
        <span class="c1"># behavior. Manually remove this instead. I&#39;m assuming only one custom</span>
        <span class="c1"># exception handler can be assigned for any one exception type and that</span>
        <span class="c1"># if we call disable(), we wish to remove the handler for Exception.</span>
        <span class="n">ipy</span><span class="o">.</span><span class="n">custom_exceptions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ipy</span><span class="o">.</span><span class="n">custom_exceptions</span>
                                      <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="ne">Exception</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="lib.roboduck.errors.stack_trace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stack_trace</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Lets us recover stack trace as string outside of the functions defined
above, which generally only execute automatically when exceptions are
thrown. Don't just define this as a partial because that requires
sys.last_value etc. to be available at import time, which it often isn't.
In the end I think I only used this for development purposes.</p>

            <details class="quote">
              <summary>Source code in <code>lib/roboduck/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stack_trace</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lets us recover stack trace as string outside of the functions defined</span>
<span class="sd">    above, which generally only execute automatically when exceptions are</span>
<span class="sd">    thrown. Don&#39;t just define this as a partial because that requires</span>
<span class="sd">    sys.last_value etc. to be available at import time, which it often isn&#39;t.</span>
<span class="sd">    In the end I think I only used this for development purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">print_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">last_type</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">last_value</span><span class="p">,</span>
                               <span class="n">sys</span><span class="o">.</span><span class="n">last_traceback</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No stack trace available because an error has &#39;</span>
                           <span class="s1">&#39;not been thrown.&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>